{
  "hash": "afd95e4bd97ea00cd379dbd774b7dcb6",
  "result": {
    "markdown": "---\ntitle: \"{{< meta dge_title >}}\"\nsubtitle: \"{{< meta subtitle_seurat >}}\"\ndescription: \"{{< meta dge_description >}}\"\nformat: html\n---\n\n\n::: {.callout-note}\nCode chunks run R commands unless otherwise specified.\n:::\n\n\n{{< meta dge_1 >}}\n\n\n{{< meta dge_2 >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressPackageStartupMessages({\n  library(Seurat)\n  library(dplyr)\n  library(cowplot)\n  library(ggplot2)\n  library(pheatmap)\n  library(enrichR)\n  library(rafalib)\n  library(Matrix)\n  library(edgeR)\n  library(MAST)\n})\n\nalldata <- readRDS(\"data/results/covid_qc_dr_int_cl.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Set the identity as louvain with resolution 0.5\nsel.clust = \"CCA_snn_res.0.5\"\n\nalldata <- SetIdent(alldata, value = sel.clust)\ntable(alldata@active.ident)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n   0    1    2    3    4    5    6    7    8    9 \n1526 1024  569  437  427  411  410  272  241  215 \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# plot this clustering\nplot_grid(ncol = 3,\n  DimPlot(alldata, label = T) + NoAxes(),\n  DimPlot(alldata, group.by = \"orig.ident\") + NoAxes(),\n  DimPlot(alldata, group.by = \"type\") + NoAxes() )\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-3-1.png){width=1152}\n:::\n:::\n\n\n## {{< meta dge_cmg >}}\n\n\n{{< meta dge_cmg_1 >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Compute differentiall expression\nmarkers_genes <- FindAllMarkers(\n    alldata,\n    log2FC.threshold = 0.2,\n    test.use = \"wilcox\",\n    min.pct = 0.1,\n    min.diff.pct = 0.2,\n    only.pos = TRUE,\n    max.cells.per.ident = 50,\n    assay = \"RNA\"\n)\n```\n:::\n\n{{< meta dge_cmg_2 >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmarkers_genes %>% group_by(cluster)  %>% top_n(-25, p_val_adj) -> top25\ntop25\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|     p_val| avg_log2FC| pct.1| pct.2| p_val_adj|cluster |gene       |\n|---------:|----------:|-----:|-----:|---------:|:-------|:----------|\n| 0.0000000|  2.7526588| 0.968| 0.094| 0.0000000|0       |MNDA       |\n| 0.0000000|  3.2319551| 0.986| 0.105| 0.0000000|0       |AC020656.1 |\n| 0.0000000|  2.8642486| 0.935| 0.042| 0.0000000|0       |CD14       |\n| 0.0000000|  3.3691875| 0.965| 0.055| 0.0000000|0       |VCAN       |\n| 0.0000000|  1.7500035| 0.954| 0.342| 0.0000000|0       |TALDO1     |\n| 0.0000000|  3.8952712| 1.000| 0.246| 0.0000000|0       |LYZ        |\n| 0.0000000|  2.3230422| 0.951| 0.066| 0.0000000|0       |CSTA       |\n| 0.0000000|  2.3830375| 0.933| 0.047| 0.0000000|0       |MS4A6A     |\n| 0.0000000|  1.7313056| 0.854| 0.106| 0.0000000|0       |BLVRB      |\n| 0.0000000|  5.1343922| 0.991| 0.242| 0.0000000|0       |S100A8     |\n| 0.0000000|  3.0595649| 0.992| 0.118| 0.0000000|0       |FCN1       |\n| 0.0000000|  2.4519054| 0.967| 0.158| 0.0000000|0       |GRN        |\n| 0.0000000|  2.1434163| 0.950| 0.145| 0.0000000|0       |CYBB       |\n| 0.0000000|  3.8399333| 0.940| 0.050| 0.0000000|0       |S100A12    |\n| 0.0000000|  2.0850701| 0.923| 0.074| 0.0000000|0       |CSF3R      |\n| 0.0000000|  1.8996634| 0.885| 0.069| 0.0000000|0       |TNFSF13B   |\n| 0.0000000|  1.6144428| 0.845| 0.077| 0.0000000|0       |CFP        |\n| 0.0000000|  1.8966813| 0.804| 0.064| 0.0000000|0       |PLAUR      |\n| 0.0000000|  4.3722734| 0.996| 0.331| 0.0000000|0       |S100A9     |\n| 0.0000000|  1.8966255| 0.880| 0.083| 0.0000000|0       |MPEG1      |\n| 0.0000000|  1.8575946| 0.822| 0.030| 0.0000000|0       |CD36       |\n| 0.0000000|  2.3719547| 0.980| 0.283| 0.0000000|0       |TYMP       |\n| 0.0000000|  1.6972589| 0.774| 0.059| 0.0000000|0       |IGSF6      |\n| 0.0000000|  1.8142623| 0.940| 0.172| 0.0000000|0       |SPI1       |\n| 0.0000000|  1.9486618| 0.985| 0.444| 0.0000000|0       |BRI3       |\n| 0.0000000|  2.1197633| 0.937| 0.186| 0.0000000|1       |CD3D       |\n| 0.0000000|  1.7399391| 0.983| 0.326| 0.0000000|1       |IL32       |\n| 0.0000000|  1.7001176| 0.951| 0.274| 0.0000000|1       |CD3E       |\n| 0.0000000|  1.8916915| 0.855| 0.163| 0.0000000|1       |CD3G       |\n| 0.0000000|  1.9508589| 0.990| 0.391| 0.0000000|1       |CCL5       |\n| 0.0000000|  1.9918666| 0.844| 0.190| 0.0000001|1       |GZMH       |\n| 0.0000000|  1.2439355| 0.958| 0.297| 0.0000017|1       |CST7       |\n| 0.0000000|  1.3598355| 0.897| 0.258| 0.0000029|1       |GZMM       |\n| 0.0000000|  1.5860847| 0.730| 0.170| 0.0000060|1       |TRAC       |\n| 0.0000000|  1.2195821| 0.779| 0.275| 0.0000094|1       |RORA       |\n| 0.0000000|  1.7022563| 0.586| 0.057| 0.0000094|1       |TRGC2      |\n| 0.0000000|  1.6195271| 0.782| 0.238| 0.0000121|1       |LYAR       |\n| 0.0000000|  1.5359565| 0.630| 0.073| 0.0000181|1       |KLRG1      |\n| 0.0000000|  0.9634264| 0.680| 0.234| 0.0000182|1       |LCK        |\n| 0.0000000|  1.0054477| 0.933| 0.656| 0.0000186|1       |CD99       |\n| 0.0000000|  1.4580271| 0.782| 0.344| 0.0000277|1       |TRBC2      |\n| 0.0000000|  1.3792771| 0.987| 0.393| 0.0000303|1       |NKG7       |\n| 0.0000000|  1.0898390| 0.910| 0.614| 0.0000681|1       |PPP2R5C    |\n| 0.0000000|  0.9353046| 0.850| 0.258| 0.0001137|1       |CTSW       |\n| 0.0000000|  1.3611959| 0.914| 0.229| 0.0001206|1       |GZMA       |\n| 0.0000000|  1.0426451| 0.547| 0.139| 0.0002790|1       |CD6        |\n| 0.0000000|  1.2231150| 0.718| 0.242| 0.0003982|1       |SPOCK2     |\n| 0.0000000|  1.1521196| 0.924| 0.469| 0.0007262|1       |ARL4C      |\n| 0.0000001|  1.7942248| 0.461| 0.041| 0.0023063|1       |CD8B       |\n| 0.0000001|  2.1761243| 0.554| 0.071| 0.0024786|1       |CD8A       |\n| 0.0000000|  2.5673312| 0.888| 0.061| 0.0000000|2       |LINC00926  |\n| 0.0000000|  3.5479370| 0.953| 0.028| 0.0000000|2       |IGHD       |\n| 0.0000000|  3.2632570| 0.975| 0.073| 0.0000000|2       |CD79A      |\n| 0.0000000|  2.4869435| 0.909| 0.065| 0.0000000|2       |MS4A1      |\n| 0.0000000|  2.4543227| 0.898| 0.067| 0.0000000|2       |TNFRSF13C  |\n| 0.0000000|  4.2481994| 0.993| 0.063| 0.0000000|2       |IGHM       |\n| 0.0000000|  1.9517703| 0.974| 0.528| 0.0000000|2       |HLA-DQB1   |\n| 0.0000000|  1.8712582| 0.991| 0.620| 0.0000000|2       |HLA-DRA    |\n| 0.0000000|  2.6029720| 0.754| 0.009| 0.0000000|2       |TCL1A      |\n| 0.0000000|  1.3983224| 0.882| 0.309| 0.0000000|2       |HLA-DQA1   |\n| 0.0000000|  1.8661538| 0.838| 0.342| 0.0000000|2       |YBX3       |\n| 0.0000000|  1.4055082| 0.782| 0.302| 0.0000000|2       |HLA-DMB    |\n| 0.0000000|  2.1402108| 0.842| 0.067| 0.0000000|2       |BANK1      |\n| 0.0000000|  1.7716880| 0.692| 0.045| 0.0000000|2       |AFF3       |\n| 0.0000000|  1.5743969| 0.974| 0.671| 0.0000000|2       |HLA-DPB1   |\n| 0.0000000|  1.7390066| 0.654| 0.050| 0.0000000|2       |CD22       |\n| 0.0000000|  2.3666327| 0.882| 0.288| 0.0000000|2       |CD83       |\n| 0.0000000|  1.1733758| 0.831| 0.391| 0.0000000|2       |HLA-DMA    |\n| 0.0000000|  1.2422358| 0.970| 0.687| 0.0000000|2       |HLA-DPA1   |\n| 0.0000000|  1.8599266| 0.652| 0.028| 0.0000001|2       |FCER2      |\n| 0.0000000|  1.5011181| 0.991| 0.709| 0.0000001|2       |HLA-DRB1   |\n| 0.0000000|  2.4677149| 0.880| 0.141| 0.0000002|2       |CD79B      |\n| 0.0000000|  1.6227274| 0.691| 0.196| 0.0000002|2       |MEF2C      |\n| 0.0000000|  1.6680884| 0.968| 0.640| 0.0000003|2       |CXCR4      |\n| 0.0000000|  1.7441200| 0.576| 0.026| 0.0000015|2       |VPREB3     |\n| 0.0000000|  2.6838843| 0.966| 0.249| 0.0000000|3       |GZMB       |\n| 0.0000000|  2.6992432| 0.943| 0.303| 0.0000000|3       |GNLY       |\n| 0.0000000|  2.7177799| 0.975| 0.257| 0.0000000|3       |PRF1       |\n| 0.0000000|  1.9511722| 0.929| 0.221| 0.0000000|3       |KLRD1      |\n| 0.0000000|  2.1798101| 0.961| 0.328| 0.0000000|3       |CD247      |\n| 0.0000000|  2.1285090| 0.986| 0.314| 0.0000000|3       |CTSW       |\n| 0.0000000|  2.1184086| 0.998| 0.460| 0.0000000|3       |NKG7       |\n| 0.0000000|  2.8696770| 0.865| 0.155| 0.0000000|3       |SPON2      |\n| 0.0000000|  2.4504964| 0.963| 0.311| 0.0000000|3       |CD7        |\n| 0.0000000|  1.5817669| 0.961| 0.518| 0.0000000|3       |ARL4C      |\n| 0.0000000|  1.7449937| 0.860| 0.270| 0.0000000|3       |HOPX       |\n| 0.0000000|  2.0803480| 0.826| 0.100| 0.0000000|3       |KLRF1      |\n| 0.0000000|  2.0551746| 0.856| 0.233| 0.0000001|3       |FGFBP2     |\n| 0.0000000|  1.9457480| 0.730| 0.109| 0.0000003|3       |IL2RB      |\n| 0.0000000|  1.5510018| 0.847| 0.253| 0.0000004|3       |FCGR3A     |\n| 0.0000000|  1.7732242| 0.970| 0.372| 0.0000004|3       |CST7       |\n| 0.0000000|  1.7269154| 0.913| 0.330| 0.0000021|3       |GZMM       |\n| 0.0000000|  1.8475681| 0.931| 0.307| 0.0000043|3       |GZMA       |\n| 0.0000000|  1.1641590| 0.641| 0.126| 0.0000078|3       |TRDC       |\n| 0.0000000|  1.4490119| 0.721| 0.190| 0.0000113|3       |MATK       |\n| 0.0000000|  2.2783540| 0.792| 0.116| 0.0000190|3       |CLIC3      |\n| 0.0000000|  2.1196619| 0.849| 0.155| 0.0000241|3       |KLRB1      |\n| 0.0000000|  1.0421418| 0.899| 0.565| 0.0001150|3       |EVL        |\n| 0.0000000|  1.5453623| 0.670| 0.139| 0.0001431|3       |S1PR5      |\n| 0.0000000|  1.0330073| 0.950| 0.722| 0.0001492|3       |HCST       |\n| 0.0000018|  0.2988093| 0.204| 0.512| 0.0325061|4       |ANP32A     |\n| 0.0000029|  0.2723390| 0.119| 0.324| 0.0532923|4       |UBE2E3     |\n| 0.0000143|  0.4177866| 0.255| 0.621| 0.2593009|4       |PSMB3      |\n| 0.0000189|  0.3143055| 0.234| 0.596| 0.3428810|4       |VPS28      |\n| 0.0000389|  0.3770437| 0.150| 0.403| 0.7040597|4       |PSMA5      |\n| 0.0000681|  0.2742818| 0.253| 0.676| 1.0000000|4       |HSP90B1    |\n| 0.0000887|  0.4555457| 0.375| 0.833| 1.0000000|4       |NDUFA4     |\n| 0.0001019|  0.3538337| 0.213| 0.485| 1.0000000|4       |CNPY3      |\n| 0.0001083|  0.7004309| 0.330| 0.735| 1.0000000|4       |SRSF3      |\n| 0.0001103|  0.3024741| 0.122| 0.360| 1.0000000|4       |SLC25A37   |\n| 0.0001317|  0.3730835| 0.340| 0.745| 1.0000000|4       |SLC25A3    |\n| 0.0001543|  0.4103063| 0.190| 0.557| 1.0000000|4       |BUD31      |\n| 0.0001597|  0.2553024| 0.112| 0.423| 1.0000000|4       |TANK       |\n| 0.0001859|  0.2577918| 0.119| 0.355| 1.0000000|4       |ACADVL     |\n| 0.0002145|  0.4244954| 0.230| 0.492| 1.0000000|4       |NCF1       |\n| 0.0002344|  0.3075716| 0.176| 0.498| 1.0000000|4       |CNN2       |\n| 0.0002362|  0.2845856| 0.176| 0.471| 1.0000000|4       |TBCB       |\n| 0.0002960|  0.3496014| 0.138| 0.402| 1.0000000|4       |SAMSN1     |\n| 0.0003125|  0.6001010| 0.258| 0.618| 1.0000000|4       |FKBP8      |\n| 0.0003169|  0.6606672| 0.272| 0.668| 1.0000000|4       |PAIP2      |\n| 0.0005251|  1.0546429| 0.222| 0.550| 1.0000000|4       |RPS27L     |\n| 0.0005671|  0.3788727| 0.208| 0.517| 1.0000000|4       |LENG8      |\n| 0.0005923|  0.2791057| 0.138| 0.411| 1.0000000|4       |ALYREF     |\n| 0.0006493|  0.4771722| 0.356| 0.820| 1.0000000|4       |SSR4       |\n| 0.0006770|  0.3531958| 0.187| 0.499| 1.0000000|4       |COX14      |\n| 0.0007357|  0.4022996| 0.185| 0.476| 1.0000000|4       |PRDX1      |\n| 0.0008248|  0.3898553| 0.222| 0.537| 1.0000000|4       |CDC37      |\n| 0.0008741|  0.3048731| 0.314| 0.708| 1.0000000|4       |CAP1       |\n| 0.0008965|  0.3744017| 0.141| 0.347| 1.0000000|4       |CAPG       |\n| 0.0010065|  0.3383049| 0.230| 0.579| 1.0000000|4       |MOB1A      |\n| 0.0010306|  0.5449567| 0.176| 0.423| 1.0000000|4       |VPS29      |\n| 0.0010418|  0.3528579| 0.173| 0.500| 1.0000000|4       |RNPEPL1    |\n| 0.0010775|  0.2590552| 0.286| 0.622| 1.0000000|4       |ARPC5      |\n| 0.0012104|  0.2692010| 0.227| 0.636| 1.0000000|4       |PSMB8      |\n| 0.0012902|  0.2854584| 0.225| 0.567| 1.0000000|4       |SELENOW    |\n| 0.0013181|  0.2911485| 0.166| 0.455| 1.0000000|4       |ZNHIT1     |\n| 0.0013731|  0.2900057| 0.276| 0.538| 1.0000000|4       |VSIR       |\n| 0.0014171|  0.4942266| 0.187| 0.520| 1.0000000|4       |CBX3       |\n| 0.0014769|  0.4119366| 0.244| 0.626| 1.0000000|4       |UFC1       |\n| 0.0015938|  0.2664887| 0.239| 0.632| 1.0000000|4       |DEK        |\n| 0.0016143|  0.2974176| 0.138| 0.356| 1.0000000|4       |COMT       |\n| 0.0017154|  1.0316015| 0.297| 0.615| 1.0000000|4       |TLN1       |\n| 0.0017262|  0.3828282| 0.192| 0.499| 1.0000000|4       |SRP9       |\n| 0.0017593|  0.3670353| 0.258| 0.684| 1.0000000|4       |ATP5MC3    |\n| 0.0017841|  0.4338332| 0.220| 0.520| 1.0000000|4       |GDI2       |\n| 0.0017960|  0.2550626| 0.253| 0.696| 1.0000000|4       |SPCS1      |\n| 0.0019403|  0.4663362| 0.304| 0.724| 1.0000000|4       |CAPZB      |\n| 0.0020334|  0.4890508| 0.206| 0.538| 1.0000000|4       |NDUFV2     |\n| 0.0021433|  0.3331404| 0.227| 0.570| 1.0000000|4       |ATF4       |\n| 0.0023289|  0.6341686| 0.185| 0.392| 1.0000000|4       |POLR2E     |\n| 0.0023637|  0.2775607| 0.199| 0.558| 1.0000000|4       |CD47       |\n| 0.0024949|  0.5274088| 0.150| 0.362| 1.0000000|4       |BANF1      |\n| 0.0025287|  0.2577544| 0.197| 0.458| 1.0000000|4       |VAMP5      |\n| 0.0025513|  0.3158038| 0.131| 0.376| 1.0000000|4       |PPA1       |\n| 0.0026168|  0.3177607| 0.150| 0.453| 1.0000000|4       |MYDGF      |\n| 0.0026416|  0.3173584| 0.274| 0.654| 1.0000000|4       |HMGN1      |\n| 0.0027843|  0.3456820| 0.309| 0.720| 1.0000000|4       |MTRNR2L12  |\n| 0.0028137|  0.3882467| 0.136| 0.367| 1.0000000|4       |UFD1       |\n| 0.0028508|  0.2526561| 0.169| 0.471| 1.0000000|4       |NDUFB1     |\n| 0.0029444|  1.1541759| 0.239| 0.621| 1.0000000|4       |EIF1B      |\n| 0.0029444|  0.4067909| 0.222| 0.531| 1.0000000|4       |RNH1       |\n| 0.0029514|  0.3515765| 0.117| 0.320| 1.0000000|4       |MRPS36     |\n| 0.0030004|  0.6744656| 0.234| 0.607| 1.0000000|4       |HMGB2      |\n| 0.0031437|  0.3543233| 0.197| 0.524| 1.0000000|4       |MDH2       |\n| 0.0031626|  0.2891805| 0.152| 0.460| 1.0000000|4       |SLC3A2     |\n| 0.0032930|  0.3132672| 0.169| 0.445| 1.0000000|4       |ANAPC11    |\n| 0.0037322|  0.2625237| 0.265| 0.721| 1.0000000|4       |PSMB1      |\n| 0.0039585|  0.2591684| 0.155| 0.398| 1.0000000|4       |NINJ1      |\n| 0.0040982|  0.2752792| 0.328| 0.777| 1.0000000|4       |TMBIM6     |\n| 0.0041672|  0.4100357| 0.262| 0.668| 1.0000000|4       |DNAJB6     |\n| 0.0042678|  0.4482798| 0.255| 0.606| 1.0000000|4       |COX5A      |\n| 0.0043240|  0.3379529| 0.286| 0.642| 1.0000000|4       |RHOG       |\n| 0.0045417|  0.3171592| 0.159| 0.427| 1.0000000|4       |UBE2J1     |\n| 0.0045970|  0.4691792| 0.162| 0.405| 1.0000000|4       |ECH1       |\n| 0.0046360|  0.5159805| 0.262| 0.634| 1.0000000|4       |CCND3      |\n| 0.0046929|  0.4012024| 0.347| 0.747| 1.0000000|4       |ATP5MPL    |\n| 0.0047906|  0.3100867| 0.180| 0.484| 1.0000000|4       |RIOK3      |\n| 0.0048018|  0.5213637| 0.262| 0.663| 1.0000000|4       |VAPA       |\n| 0.0051360|  0.3043846| 0.183| 0.531| 1.0000000|4       |GHITM      |\n| 0.0051591|  0.2520745| 0.129| 0.379| 1.0000000|4       |ATP5MC1    |\n| 0.0052436|  0.3159085| 0.150| 0.355| 1.0000000|4       |NAP1L4     |\n| 0.0054739|  0.2502194| 0.157| 0.383| 1.0000000|4       |NDUFB3     |\n| 0.0061984|  0.3738119| 0.272| 0.686| 1.0000000|4       |LDHA       |\n| 0.0063358|  0.4367972| 0.187| 0.436| 1.0000000|4       |TCIRG1     |\n| 0.0063613|  0.4487245| 0.131| 0.344| 1.0000000|4       |RANBP1     |\n| 0.0064773|  0.3251459| 0.244| 0.490| 1.0000000|4       |ANXA5      |\n| 0.0069505|  0.3185756| 0.379| 0.583| 1.0000000|4       |TKT        |\n| 0.0072546|  0.2568988| 0.201| 0.590| 1.0000000|4       |PSMD8      |\n| 0.0081254|  0.4479412| 0.211| 0.456| 1.0000000|4       |GLRX       |\n| 0.0087306|  0.6791424| 0.225| 0.560| 1.0000000|4       |UBE2B      |\n| 0.0088919|  0.2517301| 0.253| 0.541| 1.0000000|4       |MT2A       |\n| 0.0091332|  0.6590616| 0.194| 0.429| 1.0000000|4       |NUCB1      |\n| 0.0091673|  0.3144769| 0.145| 0.436| 1.0000000|4       |CCT4       |\n| 0.0093966|  0.4977166| 0.136| 0.377| 1.0000000|4       |TWF2       |\n| 0.0095685|  0.4724045| 0.244| 0.629| 1.0000000|4       |RABAC1     |\n| 0.0098593|  0.6574115| 0.215| 0.463| 1.0000000|4       |SUPT4H1    |\n| 0.0000000|  2.1835582| 0.954| 0.201| 0.0000000|5       |IL7R       |\n| 0.0000000|  1.5521272| 0.959| 0.534| 0.0000000|5       |LDHB       |\n| 0.0000000|  1.9994919| 0.966| 0.367| 0.0000005|5       |LTB        |\n| 0.0000000|  1.5546844| 0.903| 0.223| 0.0000008|5       |TRAC       |\n| 0.0000000|  1.2615428| 0.891| 0.466| 0.0000016|5       |LEPROTL1   |\n| 0.0000000|  0.7583884| 0.825| 0.248| 0.0000017|5       |CD3G       |\n| 0.0000000|  0.8749897| 0.900| 0.279| 0.0000062|5       |CD3D       |\n| 0.0000000|  1.1747288| 0.637| 0.118| 0.0000268|5       |RCAN3      |\n| 0.0000000|  0.9659632| 0.973| 0.769| 0.0000629|5       |KLF2       |\n| 0.0000000|  0.7493338| 0.418| 0.070| 0.0006229|5       |TNFRSF25   |\n| 0.0000000|  0.9536662| 0.866| 0.396| 0.0007254|5       |PIK3IP1    |\n| 0.0000001|  1.1550876| 0.723| 0.327| 0.0011702|5       |NOSIP      |\n| 0.0000001|  0.8406949| 0.944| 0.355| 0.0015218|5       |CD3E       |\n| 0.0000001|  1.3557717| 0.616| 0.137| 0.0026848|5       |GATA3      |\n| 0.0000002|  0.7322785| 0.589| 0.252| 0.0031747|5       |PBXIP1     |\n| 0.0000002|  1.1042186| 0.552| 0.092| 0.0037396|5       |AP3M2      |\n| 0.0000002|  0.9789553| 0.433| 0.039| 0.0043989|5       |AQP3       |\n| 0.0000004|  0.8624605| 0.465| 0.055| 0.0071645|5       |TRAT1      |\n| 0.0000006|  1.1023829| 0.988| 0.405| 0.0103659|5       |IL32       |\n| 0.0000013|  0.5591513| 0.440| 0.146| 0.0231174|5       |TMEM238    |\n| 0.0000015|  0.9232437| 0.667| 0.197| 0.0271442|5       |TCF7       |\n| 0.0000026|  0.5799372| 0.353| 0.056| 0.0469254|5       |LEF1       |\n| 0.0000029|  0.8312722| 0.781| 0.276| 0.0523095|5       |CD2        |\n| 0.0000030|  1.1267097| 0.506| 0.037| 0.0547826|5       |MAL        |\n| 0.0000037|  0.8512899| 0.912| 0.632| 0.0678694|5       |GSTK1      |\n| 0.0000000|  2.2368672| 1.000| 0.463| 0.0000000|6       |NKG7       |\n| 0.0000000|  2.1033868| 0.993| 0.373| 0.0000000|6       |CST7       |\n| 0.0000000|  2.4543623| 0.968| 0.304| 0.0000000|6       |GNLY       |\n| 0.0000000|  2.1177031| 0.856| 0.111| 0.0000000|6       |TRDC       |\n| 0.0000000|  2.0447025| 0.971| 0.319| 0.0000000|6       |CTSW       |\n| 0.0000000|  2.4886234| 0.949| 0.229| 0.0000000|6       |FGFBP2     |\n| 0.0000000|  2.0601598| 0.988| 0.251| 0.0000000|6       |GZMB       |\n| 0.0000000|  2.0133462| 0.976| 0.258| 0.0000002|6       |GZMH       |\n| 0.0000000|  1.7644637| 0.951| 0.332| 0.0000003|6       |CD247      |\n| 0.0000000|  1.6396709| 0.873| 0.272| 0.0000005|6       |HOPX       |\n| 0.0000000|  1.9224617| 0.995| 0.462| 0.0000007|6       |CCL5       |\n| 0.0000000|  1.8988617| 0.922| 0.265| 0.0000026|6       |PRF1       |\n| 0.0000000|  1.1623674| 0.917| 0.629| 0.0000072|6       |CD81       |\n| 0.0000000|  2.0054956| 0.529| 0.026| 0.0000268|6       |KLRC2      |\n| 0.0000000|  1.2552884| 0.644| 0.144| 0.0000319|6       |S1PR5      |\n| 0.0000000|  1.8632307| 0.917| 0.226| 0.0000373|6       |KLRD1      |\n| 0.0000000|  1.3033563| 0.841| 0.236| 0.0000516|6       |TRBC1      |\n| 0.0000000|  1.9431032| 0.768| 0.109| 0.0000557|6       |KLRF1      |\n| 0.0000000|  1.4774974| 0.880| 0.253| 0.0002340|6       |FCGR3A     |\n| 0.0000000|  1.7554731| 0.946| 0.309| 0.0002581|6       |GZMA       |\n| 0.0000000|  1.0206283| 0.898| 0.651| 0.0004048|6       |PPP2R5C    |\n| 0.0000000|  1.3302579| 0.583| 0.136| 0.0006525|6       |CLIC3      |\n| 0.0000001|  1.1507757| 0.729| 0.312| 0.0009942|6       |APMAP      |\n| 0.0000001|  1.3014262| 0.890| 0.335| 0.0010199|6       |GZMM       |\n| 0.0000001|  1.2780443| 0.620| 0.147| 0.0010392|6       |CEP78      |\n| 0.0000000|  1.6532862| 0.901| 0.406| 0.0000000|7       |PIK3IP1    |\n| 0.0000000|  1.9636174| 0.765| 0.120| 0.0000001|7       |CCR7       |\n| 0.0000000|  1.9203586| 0.949| 0.221| 0.0000003|7       |IL7R       |\n| 0.0000000|  1.3644486| 0.801| 0.374| 0.0000147|7       |GIMAP7     |\n| 0.0000000|  1.4244304| 0.853| 0.551| 0.0000329|7       |LDHB       |\n| 0.0000000|  1.2278399| 0.467| 0.074| 0.0006976|7       |CAMK4      |\n| 0.0000000|  1.6788412| 0.445| 0.016| 0.0008135|7       |TSHZ2      |\n| 0.0000001|  1.3074415| 0.846| 0.480| 0.0019166|7       |LEPROTL1   |\n| 0.0000001|  1.1852064| 0.835| 0.580| 0.0019977|7       |IKZF1      |\n| 0.0000001|  0.9777944| 0.768| 0.502| 0.0024433|7       |C12orf57   |\n| 0.0000001|  1.7790448| 0.765| 0.204| 0.0025421|7       |TCF7       |\n| 0.0000002|  1.2138665| 0.500| 0.189| 0.0029198|7       |BCL2       |\n| 0.0000002|  0.8806075| 0.912| 0.373| 0.0031297|7       |CD3E       |\n| 0.0000003|  1.5469097| 0.544| 0.054| 0.0054154|7       |LEF1       |\n| 0.0000003|  0.9608209| 0.735| 0.409| 0.0058669|7       |TRBC2      |\n| 0.0000004|  1.4008672| 0.496| 0.045| 0.0071083|7       |TRABD2A    |\n| 0.0000005|  1.7047776| 0.941| 0.384| 0.0091082|7       |LTB        |\n| 0.0000005|  0.7011943| 0.699| 0.270| 0.0093889|7       |CD3G       |\n| 0.0000007|  0.8680582| 0.426| 0.074| 0.0131311|7       |CD27       |\n| 0.0000009|  1.0600617| 0.713| 0.251| 0.0166788|7       |TRAC       |\n| 0.0000011|  1.3839811| 0.581| 0.134| 0.0190779|7       |RCAN3      |\n| 0.0000015|  1.2504376| 0.540| 0.151| 0.0276805|7       |PDE3B      |\n| 0.0000016|  1.3766879| 0.518| 0.049| 0.0290362|7       |MAL        |\n| 0.0000041|  1.0916699| 0.471| 0.140| 0.0744289|7       |BCL11B     |\n| 0.0000044|  0.8658580| 0.651| 0.368| 0.0798630|7       |CLEC2D     |\n| 0.0000000|  2.6371809| 0.992| 0.128| 0.0000000|8       |CD79A      |\n| 0.0000000|  2.1500595| 0.938| 0.111| 0.0000000|8       |BANK1      |\n| 0.0000000|  2.4100344| 0.929| 0.117| 0.0000000|8       |MS4A1      |\n| 0.0000000|  1.8766837| 0.909| 0.119| 0.0000000|8       |TNFRSF13C  |\n| 0.0000000|  1.4324621| 0.834| 0.189| 0.0000000|8       |CD79B      |\n| 0.0000000|  1.5159672| 0.826| 0.113| 0.0000000|8       |RALGPS2    |\n| 0.0000000|  1.6390299| 0.992| 0.643| 0.0000000|8       |HLA-DRA    |\n| 0.0000000|  1.5384877| 0.988| 0.689| 0.0000000|8       |HLA-DPB1   |\n| 0.0000000|  1.3768830| 0.822| 0.115| 0.0000000|8       |LINC00926  |\n| 0.0000000|  1.7072929| 0.950| 0.342| 0.0000001|8       |HLA-DQA1   |\n| 0.0000000|  1.5291404| 0.983| 0.555| 0.0000002|8       |HLA-DQB1   |\n| 0.0000000|  1.4491273| 0.710| 0.058| 0.0000003|8       |BLK        |\n| 0.0000000|  0.6446052| 0.726| 0.173| 0.0000005|8       |PDLIM1     |\n| 0.0000000|  1.3237118| 0.996| 0.703| 0.0000005|8       |HLA-DPA1   |\n| 0.0000000|  1.0448056| 0.581| 0.082| 0.0000005|8       |GNG7       |\n| 0.0000000|  1.3865715| 0.660| 0.092| 0.0000006|8       |P2RX5      |\n| 0.0000000|  0.8525238| 0.382| 0.033| 0.0000203|8       |FCRL2      |\n| 0.0000000|  1.1296329| 0.610| 0.143| 0.0000400|8       |CCDC50     |\n| 0.0000000|  1.4233836| 0.664| 0.045| 0.0000423|8       |SPIB       |\n| 0.0000000|  1.3709920| 0.934| 0.575| 0.0000879|8       |EZR        |\n| 0.0000000|  0.9160839| 0.440| 0.034| 0.0002711|8       |OSBPL10    |\n| 0.0000000|  1.4470085| 0.589| 0.042| 0.0004404|8       |IGHG3      |\n| 0.0000000|  1.2844498| 0.506| 0.039| 0.0004844|8       |COBLL1     |\n| 0.0000000|  0.9917748| 0.452| 0.035| 0.0006229|8       |CD24       |\n| 0.0000001|  0.8579067| 0.809| 0.331| 0.0009088|8       |HLA-DMB    |\n| 0.0000000|  3.0533413| 0.995| 0.385| 0.0000000|9       |LST1       |\n| 0.0000000|  2.5473430| 0.972| 0.273| 0.0000000|9       |FCGR3A     |\n| 0.0000000|  2.0092308| 0.953| 0.218| 0.0000000|9       |LRRC25     |\n| 0.0000000|  2.2459087| 0.907| 0.151| 0.0000000|9       |MS4A7      |\n| 0.0000000|  1.9438602| 0.977| 0.360| 0.0000000|9       |SPI1       |\n| 0.0000000|  3.2346530| 0.902| 0.036| 0.0000000|9       |CDKN1C     |\n| 0.0000000|  2.3852009| 1.000| 0.369| 0.0000000|9       |AIF1       |\n| 0.0000000|  2.1341440| 0.953| 0.151| 0.0000000|9       |SMIM25     |\n| 0.0000000|  1.8843737| 0.865| 0.110| 0.0000000|9       |CSF1R      |\n| 0.0000000|  2.3957297| 1.000| 0.643| 0.0000000|9       |COTL1      |\n| 0.0000000|  1.6123093| 0.851| 0.103| 0.0000000|9       |TCF7L2     |\n| 0.0000000|  1.5792253| 0.860| 0.170| 0.0000000|9       |HMOX1      |\n| 0.0000000|  1.6904513| 0.902| 0.179| 0.0000000|9       |RRAS       |\n| 0.0000000|  1.5968753| 0.940| 0.225| 0.0000000|9       |PILRA      |\n| 0.0000000|  1.3877009| 0.972| 0.590| 0.0000000|9       |RNASET2    |\n| 0.0000000|  1.9888806| 1.000| 0.611| 0.0000000|9       |PSAP       |\n| 0.0000000|  2.0073048| 0.995| 0.462| 0.0000000|9       |FCER1G     |\n| 0.0000000|  1.8077275| 0.940| 0.274| 0.0000000|9       |PECAM1     |\n| 0.0000000|  1.1476232| 0.898| 0.256| 0.0000000|9       |HCK        |\n| 0.0000000|  1.9356242| 0.977| 0.269| 0.0000000|9       |CFD        |\n| 0.0000000|  1.8569682| 0.944| 0.274| 0.0000001|9       |WARS       |\n| 0.0000000|  1.5558324| 0.730| 0.065| 0.0000001|9       |HES4       |\n| 0.0000000|  1.6914523| 0.986| 0.477| 0.0000001|9       |NPC2       |\n| 0.0000000|  1.6320396| 0.967| 0.244| 0.0000001|9       |LILRB2     |\n| 0.0000000|  2.0073076| 0.912| 0.294| 0.0000001|9       |RHOC       |\n\n</div>\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmypar(2,5,mar=c(4,6,3,1))\nfor(i in unique(top25$cluster)){\n  barplot( sort( setNames(top25$avg_log2FC, top25$gene) [top25$cluster == i], F),\n           horiz = T,las=1 ,main=paste0(i,\" vs. rest\"),border = \"white\", yaxs=\"i\" )\n  abline(v=c(0,0.25),lty=c(1,2))\n}\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n{{< meta dge_cmg_3 >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmarkers_genes %>% group_by(cluster)  %>% top_n(-5, p_val_adj) -> top5\n\n# create a scale.data slot for the selected genes\nalldata <- ScaleData(alldata, features = as.character(unique(top5$gene)), assay = \"RNA\")\nDoHeatmap(alldata, features = as.character(unique(top5$gene)),group.by = sel.clust, assay = \"RNA\")\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-7-1.png){width=768}\n:::\n:::\n\n\nAnother way is by representing the overal group expression and detection rates in a dot-plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDotPlot(alldata, features = rev(as.character(unique(top5$gene))),group.by = sel.clust,assay = \"RNA\")+coord_flip()\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-8-1.png){width=576}\n:::\n:::\n\n{{< meta dge_cmg_4 >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# take top 3 genes per cluster/\ntop5 %>% group_by(cluster)  %>% top_n(-3, p_val) -> top3\n\n# set pt.size to zero if you do not want all the points to hide the violin shapes, or to a small value like 0.1\nVlnPlot(alldata, features = as.character(unique(top3$gene)), ncol = 5, group.by = sel.clust, assay = \"RNA\", pt.size = 0)\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\n:::{.callout-note title=\"Discuss\"}\nTake a screen shot of those results and re-run the same code above with another test: \"wilcox\" (Wilcoxon Rank Sum test), \"bimod\" (Likelihood-ratio test), \"roc\" (Identifies 'markers' of gene expression using ROC analysis),\"t\" (Student's t-test),\"negbinom\" (negative binomial generalized linear model),\"poisson\" (poisson generalized linear model), \"LR\" (logistic regression), \"MAST\" (hurdle model), \"DESeq2\" (negative binomial distribution).\n:::\n\n## {{< meta dge_cond >}}\n\n\n{{< meta dge_cond_1 >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# select all cells in cluster 1\ncell_selection <- subset(alldata, cells = colnames(alldata)[ alldata@meta.data[,sel.clust] == 2])\ncell_selection <- SetIdent(cell_selection, value = \"type\")\n#Compute differentiall expression\nDGE_cell_selection <- FindAllMarkers(cell_selection,\n                               log2FC.threshold = 0.2,\n                               test.use = \"wilcox\",\n                               min.pct = 0.1,\n                               min.diff.pct = 0.2,\n                               only.pos = TRUE,\n                               max.cells.per.ident = 50,\n                               assay = \"RNA\")\n```\n:::\n\n{{< meta dge_cond_2 >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDGE_cell_selection %>% group_by(cluster)  %>% top_n(-5, p_val) -> top5_cell_selection\nVlnPlot(cell_selection, features = as.character(unique(top5_cell_selection$gene)), ncol = 5,group.by = \"type\",assay = \"RNA\", pt.size = .1)\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-11-1.png){width=768}\n:::\n:::\n\n\nWe can also plot these genes across all clusters, but split by \"type\", to check if the genes are also up/downregulated in other celltypes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nVlnPlot(alldata, features = as.character(unique(top5_cell_selection$gene)),\n        ncol = 5, split.by = \"type\",assay = \"RNA\", pt.size = 0)\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-12-1.png){width=1536}\n:::\n:::\n\n\nAs you can see, we hwve many sex chromosome related genes among the top DE genes. And if you remember from the QC lab, we have inbalanced sex distribution among our subjects, so this may not be related to covid at all. \n\n### Remove sex chromosome genes\n\nTo remove some of the bias due to inbalanced sex in the subjects we can remove the sex chromosome related genes.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngene.info = read.csv(\"data/results/genes.table.csv\") #was created in the QC exercise\n\nauto.genes = gene.info$external_gene_name[!(gene.info$chromosome_name %in% c(\"X\", \"Y\"))]\n\ncell_selection@active.assay = \"RNA\"\nkeep.genes = intersect(rownames(cell_selection), auto.genes)\ncell_selection = cell_selection[keep.genes,]\n\n# then renormalize the data\ncell_selection = NormalizeData(cell_selection)\n```\n:::\n\n\nRerun differential expression:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Compute differentiall expression\nDGE_cell_selection <- FindMarkers(cell_selection, ident.1 = \"Covid\", ident.2 = \"Ctrl\",\n                       logfc.threshold = 0.2, test.use = \"wilcox\",  min.pct = 0.1,\n                       min.diff.pct = 0.2, assay = \"RNA\")\n\n# Define as Covid or Ctrl in the df and add a gene column\nDGE_cell_selection$direction = ifelse(DGE_cell_selection$avg_log2FC > 0, \"Covid\", \"Ctrl\")\nDGE_cell_selection$gene = rownames(DGE_cell_selection)\n\n\nDGE_cell_selection %>%\n    group_by(direction) %>%\n    top_n(-5, p_val) %>%\n    arrange(direction) -> top5_cell_selection\n\nVlnPlot(cell_selection, features = as.character(unique(top5_cell_selection$gene)),\n        ncol = 5,group.by = \"type\",assay = \"RNA\", pt.size = .1)\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-14-1.png){width=960}\n:::\n:::\n\n\nWe can also plot these genes across all clusters, but split by \"type\", to check if the genes are also up/downregulated in other celltypes/clusters.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nVlnPlot(alldata, features = as.character(unique(top5_cell_selection$gene)),\n        ncol = 5, split.by = \"type\",assay = \"RNA\", pt.size = 0)\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-15-1.png){width=1440}\n:::\n:::\n\n\n## Patient Batch effects\n\nWhen we are testing for Covid vs Control we are running a DGE test for 3 vs 3 individuals. That will be very sensitive to sample differences unless we find a way to control for it. So first, lets check how the top DGEs are expressed across the individuals:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nVlnPlot(cell_selection, group.by = \"orig.ident\", features =  as.character(unique(top5_cell_selection$gene)), ncol = 5, assay = \"RNA\", pt.size = 0)\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-16-1.png){width=1440}\n:::\n:::\n\n\nAs you can see, many of the genes detected as DGE in Covid are unique to one or 2 patients.\n\nWe can examine more genes with a DotPlot:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDGE_cell_selection %>%\n    group_by(direction) %>%\n    top_n(-20, p_val) -> top20_cell_selection\nDotPlot(cell_selection, features = rev(as.character(unique(top20_cell_selection$gene))), group.by = \"orig.ident\",    assay = \"RNA\") + coord_flip()\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nAs you can see, most of the DGEs are driven by the `covid_17` patient.\n\nBut it is also the sample with the highest number of cells:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(cell_selection$orig.ident)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n covid_1 covid_15 covid_17  ctrl_13  ctrl_14   ctrl_5 \n      90       38      172       66       63      140 \n```\n:::\n:::\n\n\n## Subsample\n\nSo one obvious thing to consider is an equal amount of cells per individual so that the DGE results are not dominated by a single sample.\n\nSo we will use the `downsample` option in the Seurat function `WhichCells` to select 30 cells per cluster:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncell_selection <- SetIdent(cell_selection, value = \"orig.ident\")\nsub_data <- subset(cell_selection, cells = WhichCells(cell_selection, downsample = 30))\n\ntable(sub_data$orig.ident)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n covid_1 covid_15 covid_17  ctrl_13  ctrl_14   ctrl_5 \n      30       30       30       30       30       30 \n```\n:::\n:::\n\n\nAnd now we run DGE analysis again:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsub_data <- SetIdent(sub_data, value = \"type\")\n\n#Compute differentiall expression\nDGE_sub <- FindMarkers(sub_data, ident.1 = \"Covid\", ident.2 = \"Ctrl\",\n                       logfc.threshold = 0.2, test.use = \"wilcox\",  min.pct = 0.1,\n                       min.diff.pct = 0.2, assay = \"RNA\")\n\n# Define as Covid or Ctrl in the df and add a gene column\nDGE_sub$direction = ifelse(DGE_sub$avg_log2FC > 0, \"Covid\", \"Ctrl\")\nDGE_sub$gene = rownames(DGE_sub)\n\n\nDGE_sub %>%\n    group_by(direction) %>%\n    top_n(-5, p_val) %>%\n    arrange(direction) -> top5_sub\n\nVlnPlot(sub_data, features = as.character(unique(top5_sub$gene)),\n        ncol = 5,group.by = \"type\",assay = \"RNA\", pt.size = .1)\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-20-1.png){width=768}\n:::\n:::\n\n\nPlot as dotplot, but in the full dataset:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDGE_sub %>%\n    group_by(direction) %>%\n    top_n(-20, p_val) -> top20_sub\nDotPlot(cell_selection, features = rev(as.character(unique(top20_sub$gene))), group.by = \"orig.ident\", assay = \"RNA\") +\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-21-1.png){width=768}\n:::\n:::\n\n\nIt looks much better now. But if we look per patient you can see that we still have some genes that are dominated by a single patient.\n\nWhy do you think this is?\n\n## Pseudobulk\n\nOne option is to treat the samples as pseudobulks and do differential expression for the 3 patients vs 3 controls. You do lose some information about cell variability within each patient, but instead you gain the advantage of mainly looking for effects that are seen in multiple patients.\n\nHowever, having only 3 patients is probably too low, with many more patients it will work better to run pseudobulk analysis.\n\nFor a fair comparison we should have equal number of cells per sample when we create the pseudobulk, so we will use the subsampled object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# get the count matrix for all cells\nDGE_DATA <- sub_data@assays$RNA@counts\n\n# Compute pseudobulk\nmm <- Matrix::sparse.model.matrix(~0 + sub_data$orig.ident)\npseudobulk <- DGE_DATA %*% mm\n```\n:::\n\n\nThen run edgeR:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# define the groups\nbulk.labels = c(\"Covid\", \"Covid\", \"Covid\", \"Ctrl\", \"Ctrl\", \"Ctrl\")\n\ndge.list <- DGEList(counts = pseudobulk, group = factor(bulk.labels))\nkeep <- filterByExpr(dge.list)\ndge.list <- dge.list[keep, , keep.lib.sizes = FALSE]\n\ndge.list <- calcNormFactors(dge.list)\ndesign = model.matrix(~bulk.labels)\n\ndge.list <- estimateDisp(dge.list, design)\n\nfit <- glmQLFit(dge.list, design)\nqlf <- glmQLFTest(fit, coef = 2)\ntopTags(qlf)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCoefficient:  bulk.labelsCtrl \n           logFC    logCPM        F       PValue         FDR\nS100A9 -3.498029  7.553305 42.63147 6.198241e-06 0.006783959\nS100A8 -4.207836  7.288831 41.11483 7.704667e-06 0.006783959\nIGHA1  -3.838099  6.413437 29.34410 5.264686e-05 0.030903706\nAREG   -1.832454  6.717829 17.81616 6.199740e-04 0.272932981\nCD69   -1.845790 10.696022 16.19704 9.402281e-04 0.272932981\nJCHAIN  1.615055  7.102567 16.06508 9.736488e-04 0.272932981\nAHNAK   1.162623  8.053008 15.65996 1.084912e-03 0.272932981\nCCND3  -1.136665  7.929824 13.90824 1.763560e-03 0.317304552\nNDUFS7 -1.479698  6.849707 13.72267 1.860071e-03 0.317304552\nADPGK   1.240460  7.412317 13.54525 1.957945e-03 0.317304552\n```\n:::\n:::\n\n\nAs you can see, we have very few significant genes, actually only 2 with FDR < 0.1. Since we only have 3 vs 3 samples, we should not expect too many genes with this method.\n\nAgain as dotplot including all genes with FDR < 1:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres.edgeR <- topTags(qlf, 100)$table\nres.edgeR$dir = ifelse(res.edgeR$logFC > 0, \"Covid\", \"Ctrl\")\nres.edgeR$gene = rownames(res.edgeR)\n\nres.edgeR %>%\n    group_by(dir) %>%\n    top_n(-10, PValue) %>%\n    arrange(dir) -> top.edgeR\n\nDotPlot(cell_selection, features = as.character(unique(top.edgeR$gene)), group.by = \"orig.ident\",\n    assay = \"RNA\") + coord_flip() + ggtitle(\"EdgeR pseudobulk\") + RotatedAxis()\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-24-1.png){width=576}\n:::\n:::\n\n\nAs you can see, even if we get few genes detected the seem to make sense across all the patients.\n\n## MAST random effect\n\nMAST has the option to add a random effect for the patient when running DGE analysis. It is quite slow, even with this small dataset, so it may not be practical for a larger dataset unless you have access to a compute cluster.\n\nWe will run MAST with and without patient info as random effect and compare the results\n\nFirst, filter genes in part to speed up the process but also to avoid too many warnings in the model fitting step of MAST. We will keep genes that are expressed with at least 2 reads in 2 covid patients or 2 controls.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# select genes that are expressed in at least 2 patients or 2 ctrls with > 2 reads.\nnPatient = sapply(unique(cell_selection$orig.ident), function(x) rowSums(cell_selection@assays$RNA@counts[, cell_selection$orig.ident\n== x] > 2))\nnCovid = rowSums(nPatient[,1:3]>2)\nnCtrl = rowSums(nPatient[,4:6]>2)\n\nsel = nCovid >= 2 | nCtrl >= 2\ncell_selection_sub = cell_selection[sel, ]\n```\n:::\n\n\nSet up the MAST object.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create the feature data\nfData <- data.frame(primerid = rownames(cell_selection_sub))\nm = cell_selection_sub@meta.data\nm$wellKey = rownames(m)\n\n# make sure type and orig.ident are factors\nm$orig.ident = factor(m$orig.ident)\nm$type = factor(m$type)\n\nsca <- MAST::FromMatrix(exprsArray = as.matrix(x = cell_selection_sub@assays$RNA@data),\n    check_sanity = FALSE, cData = m, fData = fData)\n```\n:::\n\n\nFirst, run the regular MAST analysis without random effects\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# takes a while to run, so save a file to tmpdir in case you have to rerun the code\ntmpdir = \"tmp_dge\"\ndir.create(tmpdir, showWarnings = F)\n\ntmpfile1 = file.path(tmpdir, \"mast_bayesglm_cl1.Rds\")\nif (file.exists(tmpfile1)) {\n    fcHurdle1 = readRDS(tmpfile1)\n} else {\n    zlmCond <- suppressMessages(MAST::zlm(~type, sca, method = \"bayesglm\", ebayes = T))\n    summaryCond <- suppressMessages(MAST::summary(zlmCond, doLRT = \"typeCtrl\"))\n    summaryDt <- summaryCond$datatable\n    fcHurdle <- merge(summaryDt[summaryDt$contrast == \"typeCtrl\" & summaryDt$component ==\n        \"logFC\", c(1, 7, 5, 6, 8)], summaryDt[summaryDt$contrast == \"typeCtrl\" &\n        summaryDt$component == \"H\", c(1, 4)], by = \"primerid\")\n    fcHurdle1 <- stats::na.omit(as.data.frame(fcHurdle))\n    saveRDS(fcHurdle1, tmpfile1)\n}\n```\n:::\n\n\nThen run MAST with glmer and random effect.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4)\n\ntmpfile2 = file.path(tmpdir, \"mast_glme_cl1.Rds\")\nif (file.exists(tmpfile2)) {\n    fcHurdle2 = readRDS(tmpfile2)\n} else {\n    zlmCond <- suppressMessages(MAST::zlm(~type + (1 | orig.ident), sca, method = \"glmer\",\n        ebayes = F, strictConvergence = FALSE))\n\n    summaryCond <- suppressMessages(MAST::summary(zlmCond, doLRT = \"typeCtrl\"))\n    summaryDt <- summaryCond$datatable\n    fcHurdle <- merge(summaryDt[summaryDt$contrast == \"typeCtrl\" & summaryDt$component ==\n        \"logFC\", c(1, 7, 5, 6, 8)], summaryDt[summaryDt$contrast == \"typeCtrl\" &\n        summaryDt$component == \"H\", c(1, 4)], by = \"primerid\")\n    fcHurdle2 <- stats::na.omit(as.data.frame(fcHurdle))\n    saveRDS(fcHurdle2, tmpfile2)\n}\n```\n:::\n\n\nTop genes with normal MAST:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop1 = head(fcHurdle1[order(fcHurdle1$`Pr(>Chisq)`), ], 10)\ntop1\n\nfcHurdle1$pval = fcHurdle1$`Pr(>Chisq)`\nfcHurdle1$dir = ifelse(fcHurdle1$z > 0, \"up\", \"down\")\nfcHurdle1 %>%\n    group_by(dir) %>%\n    top_n(-10, pval) %>%\n    arrange(z) -> mastN\n\nmastN = mastN$primerid\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|    |primerid |       coef|      ci.hi|      ci.lo|          z| Pr(>Chisq)|\n|:---|:--------|----------:|----------:|----------:|----------:|----------:|\n|354 |HLA-DRB5 | -0.7446061| -0.5675697| -0.9216426|  -8.243506|          0|\n|719 |RPS26    |  1.2235900|  1.3827962|  1.0643838|  15.063434|          0|\n|137 |CD74     |  0.5082660|  0.5691480|  0.4473840|  16.362522|          0|\n|135 |CD69     | -1.2957525| -1.1074692| -1.4840358| -13.488336|          0|\n|407 |ISG20    | -0.8246052| -0.6759190| -0.9732914| -10.869847|          0|\n|502 |NFKBIA   | -0.7186872| -0.5705235| -0.8668508|  -9.507062|          0|\n|444 |LY6E     | -0.7355879| -0.5983015| -0.8728742| -10.501595|          0|\n|239 |EEF1A1   |  0.4471516|  0.5227196|  0.3715837|  11.597519|          0|\n|691 |RPL4     |  0.6175210|  0.7342439|  0.5007982|  10.369168|          0|\n|742 |S100A9   | -0.5951318| -0.4823484| -0.7079152| -10.342274|          0|\n\n</div>\n:::\n:::\n\n\nTop genes with random effect:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop2 = head(fcHurdle2[order(fcHurdle2$`Pr(>Chisq)`), ], 10)\ntop2\n\nfcHurdle2$pval = fcHurdle2$`Pr(>Chisq)`\nfcHurdle2$dir = ifelse(fcHurdle2$z > 0, \"up\", \"down\")\nfcHurdle2 %>%\n    group_by(dir) %>%\n    top_n(-10, pval) %>%\n    arrange(z) -> mastR\n\nmastR = mastR$primerid\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|    |primerid |       coef|      ci.hi|      ci.lo|          z| Pr(>Chisq)|\n|:---|:--------|----------:|----------:|----------:|----------:|----------:|\n|742 |S100A9   | -0.5982102| -0.4844424| -0.7119780| -10.305817|  0.0000642|\n|352 |HLA-DRA  |  0.3709825|  0.4704648|  0.2715002|   7.308965|  0.0000712|\n|741 |S100A8   | -0.5208571| -0.3588862| -0.6828281|  -6.302742|  0.0000772|\n|551 |PHACTR1  | -0.4797035| -0.3439641| -0.6154430|  -6.926516|  0.0000998|\n|349 |HLA-DPB1 |  0.3623810|  0.4678909|  0.2568711|   6.731630|  0.0001384|\n|760 |SF1      |  0.5052604|  0.7601909|  0.2503299|   3.884557|  0.0002655|\n|413 |JCHAIN   |  0.2814208|  0.3974764|  0.1653651|   4.752674|  0.0002772|\n|538 |PCBP2    |  0.2774759|  0.4023045|  0.1526474|   4.356718|  0.0004184|\n|954 |ZFAS1    |  0.2846779|  0.4178066|  0.1515491|   4.191118|  0.0007799|\n|348 |HLA-DPA1 |  0.2942377|  0.4170246|  0.1714508|   4.696716|  0.0007928|\n\n</div>\n:::\n:::\n\n\nAs you can see, we have lower significance for the genes with the random effect added.\n\nDotplot for top10 genes in each direction:\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 = DotPlot(cell_selection, features = mastN, group.by = \"orig.ident\", assay = \"RNA\") +\n    coord_flip() + RotatedAxis() + ggtitle(\"Regular MAST\")\n\np2 = DotPlot(cell_selection, features = mastR, group.by = \"orig.ident\", assay = \"RNA\") +\n    coord_flip() + RotatedAxis() + ggtitle(\"With random effect\")\n\np1 + p2\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-31-1.png){width=1344}\n:::\n:::\n\n\n## {{< meta dge_gsa >}}\n\n### {{< meta dge_gsa_hyper >}}\n\n\n{{< meta dge_gsa_hyper_1 >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load additional packages\nlibrary(enrichR)\n\n# Check available databases to perform enrichment (then choose one)\nenrichR::listEnrichrDbs()\n\n# Perform enrichment\nenrich_results <- enrichr(\n genes     = DGE_cell_selection$gene[DGE_cell_selection$avg_log2FC > 0],\n databases = \"GO_Biological_Process_2017b\" )[[1]]\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| geneCoverage| genesPerTerm|libraryName                                        |link                                                                            | numTerms|appyter                                  | categoryId|\n|------------:|------------:|:--------------------------------------------------|:-------------------------------------------------------------------------------|--------:|:----------------------------------------|----------:|\n|        13362|          275|Genome_Browser_PWMs                                |http://hgdownload.cse.ucsc.edu/goldenPath/hg18/database/                        |      615|ea115789fcbf12797fd692cec6df0ab4dbc79c6a |          1|\n|        27884|         1284|TRANSFAC_and_JASPAR_PWMs                           |http://jaspar.genereg.net/html/DOWNLOAD/                                        |      326|7d42eb43a64a4e3b20d721fc7148f685b53b6b30 |          1|\n|         6002|           77|Transcription_Factor_PPIs                          |                                                                                |      290|849f222220618e2599d925b6b51868cf1dab3763 |          1|\n|        47172|         1370|ChEA_2013                                          |http://amp.pharm.mssm.edu/lib/cheadownload.jsp                                  |      353|7ebe772afb55b63b41b79dd8d06ea0fdd9fa2630 |          7|\n|        47107|          509|Drug_Perturbations_from_GEO_2014                   |http://www.ncbi.nlm.nih.gov/geo/                                                |      701|ad270a6876534b7cb063e004289dcd4d3164f342 |          7|\n|        21493|         3713|ENCODE_TF_ChIP-seq_2014                            |http://genome.ucsc.edu/ENCODE/downloads.html                                    |      498|497787ebc418d308045efb63b8586f10c526af51 |          7|\n|         1295|           18|BioCarta_2013                                      |https://cgap.nci.nih.gov/Pathways/BioCarta_Pathways                             |      249|4a293326037a5229aedb1ad7b2867283573d8bcd |          7|\n|         3185|           73|Reactome_2013                                      |http://www.reactome.org/download/index.html                                     |       78|b343994a1b68483b0122b08650201c9b313d5c66 |          7|\n|         2854|           34|WikiPathways_2013                                  |http://www.wikipathways.org/index.php/Download_Pathways                         |      199|5c307674c8b97e098f8399c92f451c0ff21cbf68 |          7|\n|        15057|          300|Disease_Signatures_from_GEO_up_2014                |http://www.ncbi.nlm.nih.gov/geo/                                                |      142|248c4ed8ea28352795190214713c86a39fd7afab |          7|\n|         4128|           48|KEGG_2013                                          |http://www.kegg.jp/kegg/download/                                               |      200|eb26f55d3904cb0ea471998b6a932a9bf65d8e50 |          7|\n|        34061|          641|TF-LOF_Expression_from_GEO                         |http://www.ncbi.nlm.nih.gov/geo/                                                |      269|                                         |          1|\n|         7504|          155|TargetScan_microRNA                                |http://www.targetscan.org/cgi-bin/targetscan/data_download.cgi?db=vert_61       |      222|f4029bf6a62c91ab29401348e51df23b8c44c90f |          7|\n|        16399|          247|PPI_Hub_Proteins                                   |http://amp.pharm.mssm.edu/X2K                                                   |      385|69c0cfe07d86f230a7ef01b365abcc7f6e52f138 |          2|\n|        12753|           57|GO_Molecular_Function_2015                         |http://www.geneontology.org/GO.downloads.annotations.shtml                      |     1136|f531ac2b6acdf7587a54b79b465a5f4aab8f00f9 |          7|\n|        23726|          127|GeneSigDB                                          |https://pubmed.ncbi.nlm.nih.gov/22110038/                                       |     2139|6d655e0aa3408a7accb3311fbda9b108681a8486 |          4|\n|        32740|           85|Chromosome_Location                                |http://software.broadinstitute.org/gsea/msigdb/index.jsp                        |      386|8dab0f96078977223646ff63eb6187e0813f1433 |          7|\n|        13373|          258|Human_Gene_Atlas                                   |http://biogps.org/downloads/                                                    |       84|0741451470203d7c40a06274442f25f74b345c9c |          5|\n|        19270|          388|Mouse_Gene_Atlas                                   |http://biogps.org/downloads/                                                    |       96|31191bfadded5f96983f93b2a113cf2110ff5ddb |          5|\n|        13236|           82|GO_Cellular_Component_2015                         |http://www.geneontology.org/GO.downloads.annotations.shtml                      |      641|e1d004d5797cbd2363ef54b1c3b361adb68795c6 |          7|\n|        14264|           58|GO_Biological_Process_2015                         |http://www.geneontology.org/GO.downloads.annotations.shtml                      |     5192|bf120b6e11242b1a64c80910d8e89f87e618e235 |          7|\n|         3096|           31|Human_Phenotype_Ontology                           |http://www.human-phenotype-ontology.org/                                        |     1779|17a138b0b70aa0e143fe63c14f82afb70bc3ed0a |          3|\n|        22288|         4368|Epigenomics_Roadmap_HM_ChIP-seq                    |http://www.roadmapepigenomics.org/                                              |      383|e1bc8a398e9b21f9675fb11bef18087eda21b1bf |          1|\n|         4533|           37|KEA_2013                                           |http://amp.pharm.mssm.edu/lib/keacommandline.jsp                                |      474|462045609440fa1e628a75716b81a1baa5bd9145 |          7|\n|        10231|          158|NURSA_Human_Endogenous_Complexome                  |https://www.nursa.org/nursa/index.jsf                                           |     1796|7d3566b12ebc23dd23d9ca9bb97650f826377b16 |          2|\n|         2741|            5|CORUM                                              |http://mips.helmholtz-muenchen.de/genre/proj/corum/                             |     1658|d047f6ead7831b00566d5da7a3b027ed9196e104 |          2|\n|         5655|          342|SILAC_Phosphoproteomics                            |http://amp.pharm.mssm.edu/lib/keacommandline.jsp                                |       84|54dcd9438b33301deb219866e162b0f9da7e63a0 |          2|\n|        10406|          715|MGI_Mammalian_Phenotype_Level_3                    |http://www.informatics.jax.org/                                                 |       71|c3bfc90796cfca8f60cba830642a728e23a53565 |          7|\n|        10493|          200|MGI_Mammalian_Phenotype_Level_4                    |http://www.informatics.jax.org/                                                 |      476|0b09a9a1aa0af4fc7ea22d34a9ae644d45864bd6 |          7|\n|        11251|          100|Old_CMAP_up                                        |http://www.broadinstitute.org/cmap/                                             |     6100|9041f90cccbc18479138330228b336265e09021c |          7|\n|         8695|          100|Old_CMAP_down                                      |http://www.broadinstitute.org/cmap/                                             |     6100|ebc0d905b3b3142f936d400c5f2a4ff926c81c37 |          7|\n|         1759|           25|OMIM_Disease                                       |http://www.omim.org/downloads                                                   |       90|cb2b92578a91e023d0498a334923ee84add34eca |          4|\n|         2178|           89|OMIM_Expanded                                      |http://www.omim.org/downloads                                                   |      187|27eca242904d8e12a38cf8881395bc50d57a03e1 |          4|\n|          851|           15|VirusMINT                                          |http://mint.bio.uniroma2.it/download.html                                       |       85|5abad1fc36216222b0420cadcd9be805a0dda63e |          4|\n|        10061|          106|MSigDB_Computational                               |http://www.broadinstitute.org/gsea/msigdb/collections.jsp                       |      858|e4cdcc7e259788fdf9b25586cce3403255637064 |          4|\n|        11250|          166|MSigDB_Oncogenic_Signatures                        |http://www.broadinstitute.org/gsea/msigdb/collections.jsp                       |      189|c76f5319c33c4833c71db86a30d7e33cd63ff8cf |          4|\n|        15406|          300|Disease_Signatures_from_GEO_down_2014              |http://www.ncbi.nlm.nih.gov/geo/                                                |      142|aabdf7017ae55ae75a004270924bcd336653b986 |          7|\n|        17711|          300|Virus_Perturbations_from_GEO_up                    |http://www.ncbi.nlm.nih.gov/geo/                                                |      323|45268b7fc680d05dd9a29743c2f2b2840a7620bf |          4|\n|        17576|          300|Virus_Perturbations_from_GEO_down                  |http://www.ncbi.nlm.nih.gov/geo/                                                |      323|5f531580ccd168ee4acc18b02c6bdf8200e19d08 |          4|\n|        15797|          176|Cancer_Cell_Line_Encyclopedia                      |https://portals.broadinstitute.org/ccle/home                                    |      967|eb38dbc3fb20adafa9d6f9f0b0e36f378e75284f |          5|\n|        12232|          343|NCI-60_Cancer_Cell_Lines                           |http://biogps.org/downloads/                                                    |       93|75c81676d8d6d99d262c9660edc024b78cfb07c9 |          5|\n|        13572|          301|Tissue_Protein_Expression_from_ProteomicsDB        |https://www.proteomicsdb.org/                                                   |      207|                                         |          7|\n|         6454|          301|Tissue_Protein_Expression_from_Human_Proteome_Map  |http://www.humanproteomemap.org/index.php                                       |       30|49351dc989f9e6ca97c55f8aca7778aa3bfb84b9 |          5|\n|         3723|           47|HMDB_Metabolites                                   |http://www.hmdb.ca/downloads                                                    |     3906|1905132115d22e4119bce543bdacaab074edb363 |          6|\n|         7588|           35|Pfam_InterPro_Domains                              |ftp://ftp.ebi.ac.uk/pub/databases/interpro/                                     |      311|e2b4912cfb799b70d87977808c54501544e4cdc9 |          6|\n|         7682|           78|GO_Biological_Process_2013                         |http://www.geneontology.org/GO.downloads.annotations.shtml                      |      941|5216d1ade194ffa5a6c00f105e2b1899f64f45fe |          7|\n|         7324|          172|GO_Cellular_Component_2013                         |http://www.geneontology.org/GO.downloads.annotations.shtml                      |      205|fd1332a42395e0bc1dba82868b39be7983a48cc5 |          7|\n|         8469|          122|GO_Molecular_Function_2013                         |http://www.geneontology.org/GO.downloads.annotations.shtml                      |      402|7e3e99e5aae02437f80b0697b197113ce3209ab0 |          7|\n|        13121|          305|Allen_Brain_Atlas_up                               |http://www.brain-map.org/                                                       |     2192|3804715a63a308570e47aa1a7877f01147ca6202 |          5|\n|        26382|         1811|ENCODE_TF_ChIP-seq_2015                            |http://genome.ucsc.edu/ENCODE/downloads.html                                    |      816|56b6adb4dc8a2f540357ef992d6cd93dfa2907e5 |          1|\n|        29065|         2123|ENCODE_Histone_Modifications_2015                  |http://genome.ucsc.edu/ENCODE/downloads.html                                    |      412|55b56cd8cf2ff04b26a09b9f92904008b82f3a6f |          1|\n|          280|            9|Phosphatase_Substrates_from_DEPOD                  |http://www.koehn.embl.de/depod/                                                 |       59|d40701e21092b999f4720d1d2b644dd0257b6259 |          2|\n|        13877|          304|Allen_Brain_Atlas_down                             |http://www.brain-map.org/                                                       |     2192|ea67371adec290599ddf484ced2658cfae259304 |          5|\n|        15852|          912|ENCODE_Histone_Modifications_2013                  |http://genome.ucsc.edu/ENCODE/downloads.html                                    |      109|c209ae527bc8e98e4ccd27a668d36cd2c80b35b4 |          7|\n|         4320|          129|Achilles_fitness_increase                          |http://www.broadinstitute.org/achilles                                          |      216|98366496a75f163164106e72439fb2bf2f77de4e |          4|\n|         4271|          128|Achilles_fitness_decrease                          |http://www.broadinstitute.org/achilles                                          |      216|83a710c1ff67fd6b8af0d80fa6148c40dbd9bc64 |          4|\n|        10496|          201|MGI_Mammalian_Phenotype_2013                       |http://www.informatics.jax.org/                                                 |      476|a4c6e217a81a4a58ff5a1c9fc102b70beab298e9 |          7|\n|         1678|           21|BioCarta_2015                                      |https://cgap.nci.nih.gov/Pathways/BioCarta_Pathways                             |      239|70e4eb538daa7688691acfe5d9c3c19022be832b |          7|\n|          756|           12|HumanCyc_2015                                      |http://humancyc.org/                                                            |      125|711f0c02b23f5e02a01207174943cfeee9d3ea9c |          7|\n|         3800|           48|KEGG_2015                                          |http://www.kegg.jp/kegg/download/                                               |      179|e80d25c56de53c704791ddfdc6ab5eec28ae7243 |          7|\n|         2541|           39|NCI-Nature_2015                                    |http://pid.nci.nih.gov/                                                         |      209|47edfc012bcbb368a10b717d8dca103f7814b5a4 |          7|\n|         1918|           39|Panther_2015                                       |http://www.pantherdb.org/                                                       |      104|ab824aeeff0712bab61f372e43aebb870d1677a9 |          7|\n|         5863|           51|WikiPathways_2015                                  |http://www.wikipathways.org/index.php/Download_Pathways                         |      404|1f7eea2f339f37856522c1f1c70ec74c7b25325f |          7|\n|         6768|           47|Reactome_2015                                      |http://www.reactome.org/download/index.html                                     |     1389|36e541bee015eddb8d53827579549e30fe7a3286 |          7|\n|        25651|          807|ESCAPE                                             |http://www.maayanlab.net/ESCAPE/                                                |      315|a7acc741440264717ff77751a7e5fed723307835 |          5|\n|        19129|         1594|HomoloGene                                         |http://www.ncbi.nlm.nih.gov/homologene                                          |       12|663b665b75a804ef98add689f838b68e612f0d2a |          6|\n|        23939|          293|Disease_Perturbations_from_GEO_down                |http://www.ncbi.nlm.nih.gov/geo/                                                |      839|0f412e0802d76efa0374504c2c9f5e0624ff7f09 |          8|\n|        23561|          307|Disease_Perturbations_from_GEO_up                  |http://www.ncbi.nlm.nih.gov/geo/                                                |      839|9ddc3902fb01fb9eaf1a2a7c2ff3acacbb48d37e |          8|\n|        23877|          302|Drug_Perturbations_from_GEO_down                   |http://www.ncbi.nlm.nih.gov/geo/                                                |      906|068623a05ecef3e4a5e0b4f8db64bb8faa3c897f |          8|\n|        15886|            9|Genes_Associated_with_NIH_Grants                   |https://grants.nih.gov/grants/oer.htm                                           |    32876|76fc5ec6735130e287e62bae6770a3c5ee068645 |          6|\n|        24350|          299|Drug_Perturbations_from_GEO_up                     |http://www.ncbi.nlm.nih.gov/geo/                                                |      906|c9c2155b5ac81ac496854fa61ba566dcae06cc80 |          8|\n|         3102|           25|KEA_2015                                           |http://amp.pharm.mssm.edu/Enrichr                                               |      428|18a081774e6e0aaf60b1a4be7fd20afcf9e08399 |          2|\n|        31132|          298|Gene_Perturbations_from_GEO_up                     |http://www.ncbi.nlm.nih.gov/geo/                                                |     2460|53dedc29ce3100930d68e506f941ef59de05dc6b |          8|\n|        30832|          302|Gene_Perturbations_from_GEO_down                   |http://www.ncbi.nlm.nih.gov/geo/                                                |     2460|499882af09c62dd6da545c15cb51c1dc5e234f78 |          8|\n|        48230|         1429|ChEA_2015                                          |http://amp.pharm.mssm.edu/Enrichr                                               |      395|712eb7b6edab04658df153605ec6079fa89fb5c7 |          7|\n|         5613|           36|dbGaP                                              |http://www.ncbi.nlm.nih.gov/gap                                                 |      345|010f1267055b1a1cb036e560ea525911c007a666 |          4|\n|         9559|           73|LINCS_L1000_Chem_Pert_up                           |https://clue.io/                                                                |    33132|5e678b3debe8d8ea95187d0cd35c914017af5eb3 |          7|\n|         9448|           63|LINCS_L1000_Chem_Pert_down                         |https://clue.io/                                                                |    33132|fedbf5e221f45ee60ebd944f92569b5eda7f2330 |          7|\n|        16725|         1443|GTEx_Tissue_Expression_Down                        |http://www.gtexportal.org/                                                      |     2918|74b818bd299a9c42c1750ffe43616aa9f7929f02 |          5|\n|        19249|         1443|GTEx_Tissue_Expression_Up                          |http://www.gtexportal.org/                                                      |     2918|103738763d89cae894bec9f145ac28167a90e611 |          5|\n|        15090|          282|Ligand_Perturbations_from_GEO_down                 |http://www.ncbi.nlm.nih.gov/geo/                                                |      261|1eb3c0426140340527155fd0ef67029db2a72191 |          8|\n|        16129|          292|Aging_Perturbations_from_GEO_down                  |http://www.ncbi.nlm.nih.gov/geo/                                                |      286|cd95fe1b505ba6f28cd722cfba50fdea979d3b4c |          8|\n|        15309|          308|Aging_Perturbations_from_GEO_up                    |http://www.ncbi.nlm.nih.gov/geo/                                                |      286|74c4f0a0447777005b2a5c00c9882a56dfc62d7c |          8|\n|        15103|          318|Ligand_Perturbations_from_GEO_up                   |http://www.ncbi.nlm.nih.gov/geo/                                                |      261|31baa39da2931ddd5f7aedf2d0bbba77d2ba7b46 |          8|\n|        15022|          290|MCF7_Perturbations_from_GEO_down                   |http://www.ncbi.nlm.nih.gov/geo/                                                |      401|555f68aef0a29a67b614a0d7e20b6303df9069c6 |          8|\n|        15676|          310|MCF7_Perturbations_from_GEO_up                     |http://www.ncbi.nlm.nih.gov/geo/                                                |      401|1bc2ba607f1ff0dda44e2a15f32a2c04767da18c |          8|\n|        15854|          279|Microbe_Perturbations_from_GEO_down                |http://www.ncbi.nlm.nih.gov/geo/                                                |      312|9e613dba78ef7e60676b13493a9dc49ccd3c8b3f |          8|\n|        15015|          321|Microbe_Perturbations_from_GEO_up                  |http://www.ncbi.nlm.nih.gov/geo/                                                |      312|d0c3e2a68e8c611c669098df2c87b530cec3e132 |          8|\n|         3788|          159|LINCS_L1000_Ligand_Perturbations_down              |https://clue.io/                                                                |       96|957846cb05ef31fc8514120516b73cc65af7980e |          7|\n|         3357|          153|LINCS_L1000_Ligand_Perturbations_up                |https://clue.io/                                                                |       96|3bd494146c98d8189898a947f5ef5710f1b7c4b2 |          7|\n|        12668|          300|L1000_Kinase_and_GPCR_Perturbations_down           |https://clue.io/                                                                |     3644|1ccc5bce553e0c2279f8e3f4ddcfbabcf566623b |          7|\n|        12638|          300|L1000_Kinase_and_GPCR_Perturbations_up             |https://clue.io/                                                                |     3644|b54a0d4ba525eac4055c7314ca9d9312adcb220c |          7|\n|         8973|           64|Reactome_2016                                      |http://www.reactome.org/download/index.html                                     |     1530|1f54638e8f45075fb79489f0e0ef906594cb0678 |          7|\n|         7010|           87|KEGG_2016                                          |http://www.kegg.jp/kegg/download/                                               |      293|43f56da7540195ba3c94eb6e34c522a699b36da9 |          7|\n|         5966|           51|WikiPathways_2016                                  |http://www.wikipathways.org/index.php/Download_Pathways                         |      437|340be98b444cad50bb974df69018fd598e23e5e1 |          7|\n|        15562|          887|ENCODE_and_ChEA_Consensus_TFs_from_ChIP-X          |                                                                                |      104|5426f7747965c23ef32cff46fabf906e2cd76bfa |          1|\n|        17850|          300|Kinase_Perturbations_from_GEO_down                 |http://www.ncbi.nlm.nih.gov/geo/                                                |      285|bb9682d78b8fc43be842455e076166fcd02cefc3 |          2|\n|        17660|          300|Kinase_Perturbations_from_GEO_up                   |http://www.ncbi.nlm.nih.gov/geo/                                                |      285|78618915009cac3a0663d6f99d359e39a31b6660 |          2|\n|         1348|           19|BioCarta_2016                                      |http://cgap.nci.nih.gov/Pathways/BioCarta_Pathways                              |      237|13d9ab18921d5314a5b2b366f6142b78ab0ff6aa |          2|\n|          934|           13|HumanCyc_2016                                      |http://humancyc.org/                                                            |      152|d6a502ef9b4c789ed5e73ca5a8de372796e5c72a |          2|\n|         2541|           39|NCI-Nature_2016                                    |http://pid.nci.nih.gov/                                                         |      209|3c1e1f7d1a651d9aaa198e73704030716fc09431 |          2|\n|         2041|           42|Panther_2016                                       |http://www.pantherdb.org/pathway/                                               |      112|ca5f6abf7f75d9baae03396e84d07300bf1fd051 |          2|\n|         5209|          300|DrugMatrix                                         |https://ntp.niehs.nih.gov/drugmatrix/                                           |     7876|255c3db820d612f34310f22a6985dad50e9fe1fe |          4|\n|        49238|         1550|ChEA_2016                                          |http://amp.pharm.mssm.edu/Enrichr                                               |      645|af271913344aa08e6a755af1d433ef15768d749a |          7|\n|         2243|           19|huMAP                                              |http://proteincomplexes.org/                                                    |      995|249247d2f686d3eb4b9e4eb976c51159fac80a89 |          2|\n|        19586|          545|Jensen_TISSUES                                     |http://tissues.jensenlab.org/                                                   |     1842|e8879ab9534794721614d78fe2883e9e564d7759 |          3|\n|        22440|          505|RNA-Seq_Disease_Gene_and_Drug_Signatures_from_GEO  |http://www.ncbi.nlm.nih.gov/geo/                                                |     1302|f0752e4d7f5198f86446678966b260c530d19d78 |          8|\n|         8184|           24|MGI_Mammalian_Phenotype_2017                       |http://www.informatics.jax.org/                                                 |     5231|0705e59bff98deda6e9cbe00cfcdd871c85e7d04 |          7|\n|        18329|          161|Jensen_COMPARTMENTS                                |http://compartments.jensenlab.org/                                              |     2283|56ec68c32d4e83edc2ee83bea0e9f6a3829b2279 |          3|\n|        15755|           28|Jensen_DISEASES                                    |http://diseases.jensenlab.org/                                                  |     1811|3045dff8181367c1421627bb8e4c5a32c6d67f98 |          3|\n|        10271|           22|BioPlex_2017                                       |http://bioplex.hms.harvard.edu/                                                 |     3915|b8620b1a9d0d271d1a2747d8cfc63589dba39991 |          2|\n|        10427|           38|GO_Cellular_Component_2017                         |http://www.geneontology.org/                                                    |      636|8fed21d22dfcc3015c05b31d942fdfc851cc8e04 |          7|\n|        10601|           25|GO_Molecular_Function_2017                         |http://www.geneontology.org/                                                    |      972|b4018906e0a8b4e81a1b1afc51e0a2e7655403eb |          7|\n|        13822|           21|GO_Biological_Process_2017                         |http://www.geneontology.org/                                                    |     3166|d9da4dba4a3eb84d4a28a3835c06dfbbe5811f92 |          7|\n|         8002|          143|GO_Cellular_Component_2017b                        |http://www.geneontology.org/                                                    |      816|ecf39c41fa5bc7deb625a2b5761a708676e9db7c |          7|\n|        10089|           45|GO_Molecular_Function_2017b                        |http://www.geneontology.org/                                                    |     3271|8d8340361dd36a458f1f0a401f1a3141de1f3200 |          7|\n|        13247|           49|GO_Biological_Process_2017b                        |http://www.geneontology.org/                                                    |    10125|6404c38bffc2b3732de4e3fbe417b5043009fe34 |          7|\n|        21809|         2316|ARCHS4_Tissues                                     |http://amp.pharm.mssm.edu/archs4                                                |      108|4126374338235650ab158ba2c61cd2e2383b70df |          5|\n|        23601|         2395|ARCHS4_Cell-lines                                  |http://amp.pharm.mssm.edu/archs4                                                |      125|5496ef9c9ae9429184d0b9485c23ba468ee522a8 |          5|\n|        20883|          299|ARCHS4_IDG_Coexp                                   |http://amp.pharm.mssm.edu/archs4                                                |      352|ce60be284fdd5a9fc6240a355421a9e12b1ee84a |          4|\n|        19612|          299|ARCHS4_Kinases_Coexp                               |http://amp.pharm.mssm.edu/archs4                                                |      498|6721c5ed97b7772e4a19fdc3f797110df0164b75 |          2|\n|        25983|          299|ARCHS4_TFs_Coexp                                   |http://amp.pharm.mssm.edu/archs4                                                |     1724|8a468c3ae29fa68724f744cbef018f4f3b61c5ab |          1|\n|        19500|          137|SysMyo_Muscle_Gene_Sets                            |http://sys-myo.rhcloud.com/                                                     |     1135|                                         |          8|\n|        14893|          128|miRTarBase_2017                                    |http://mirtarbase.mbc.nctu.edu.tw/                                              |     3240|6b7c7fe2a97b19aecbfba12d8644af6875ad99c4 |          1|\n|        17598|         1208|TargetScan_microRNA_2017                           |http://www.targetscan.org/                                                      |      683|79d13fb03d2fa6403f9be45c90eeda0f6822e269 |          1|\n|         5902|          109|Enrichr_Libraries_Most_Popular_Genes               |http://amp.pharm.mssm.edu/Enrichr                                               |      121|e9b7d8ee237d0a690bd79d970a23a9fa849901ed |          6|\n|        12486|          299|Enrichr_Submissions_TF-Gene_Coocurrence            |http://amp.pharm.mssm.edu/Enrichr                                               |     1722|be2ca8ef5a8c8e17d7e7bd290e7cbfe0951396c0 |          1|\n|         1073|          100|Data_Acquisition_Method_Most_Popular_Genes         |http://amp.pharm.mssm.edu/Enrichr                                               |       12|17ce5192b9eba7d109b6d228772ea8ab222e01ef |          6|\n|        19513|          117|DSigDB                                             |http://tanlab.ucdenver.edu/DSigDB/DSigDBv1.0/                                   |     4026|287476538ab98337dbe727b3985a436feb6d192a |          4|\n|        14433|           36|GO_Biological_Process_2018                         |http://www.geneontology.org/                                                    |     5103|b5b77681c46ac58cd050e60bcd4ad5041a9ab0a9 |          7|\n|         8655|           61|GO_Cellular_Component_2018                         |http://www.geneontology.org/                                                    |      446|e9ebe46188efacbe1056d82987ff1c70218fa7ae |          7|\n|        11459|           39|GO_Molecular_Function_2018                         |http://www.geneontology.org/                                                    |     1151|79ff80ae9a69dd00796e52569e41422466fa0bee |          7|\n|        19741|          270|TF_Perturbations_Followed_by_Expression            |http://www.ncbi.nlm.nih.gov/geo/                                                |     1958|34d08a4878c19584aaf180377f2ea96faa6a6eb1 |          1|\n|        27360|          802|Chromosome_Location_hg19                           |http://hgdownload.cse.ucsc.edu/downloads.html                                   |       36|fdab39c467ba6b0fb0288df1176d7dfddd7196d5 |          6|\n|        13072|           26|NIH_Funded_PIs_2017_Human_GeneRIF                  |https://www.ncbi.nlm.nih.gov/pubmed/                                            |     5687|859b100fac3ca774ad84450b1fbb65a78fcc6b12 |          6|\n|        13464|           45|NIH_Funded_PIs_2017_Human_AutoRIF                  |https://www.ncbi.nlm.nih.gov/pubmed/                                            |    12558|fc5bf033b932cf173633e783fc8c6228114211f8 |          6|\n|        13787|          200|Rare_Diseases_AutoRIF_ARCHS4_Predictions           |https://amp.pharm.mssm.edu/geneshot/                                            |     3725|375ff8cdd64275a916fa24707a67968a910329bb |          4|\n|        13929|          200|Rare_Diseases_GeneRIF_ARCHS4_Predictions           |https://www.ncbi.nlm.nih.gov/gene/about-generif                                 |     2244|0f7fb7f347534779ecc6c87498e96b5460a8d652 |          4|\n|        16964|          200|NIH_Funded_PIs_2017_AutoRIF_ARCHS4_Predictions     |https://www.ncbi.nlm.nih.gov/pubmed/                                            |    12558|f77de51aaf0979dd6f56381cf67ba399b4640d28 |          6|\n|        17258|          200|NIH_Funded_PIs_2017_GeneRIF_ARCHS4_Predictions     |https://www.ncbi.nlm.nih.gov/pubmed/                                            |     5684|25fa899b715cd6a9137f6656499f89cd25144029 |          6|\n|        10352|           58|Rare_Diseases_GeneRIF_Gene_Lists                   |https://www.ncbi.nlm.nih.gov/gene/about-generif                                 |     2244|0fb9ac92dbe52024661c088f71a1134f00567a8b |          4|\n|        10471|           76|Rare_Diseases_AutoRIF_Gene_Lists                   |https://amp.pharm.mssm.edu/geneshot/                                            |     3725|ee3adbac2da389959410260b280e7df1fd3730df |          4|\n|        12419|          491|SubCell_BarCode                                    |http://www.subcellbarcode.org/                                                  |      104|b50bb9480d8a77103fb75b331fd9dd927246939a |          2|\n|        19378|           37|GWAS_Catalog_2019                                  |https://www.ebi.ac.uk/gwas                                                      |     1737|fef3864bcb5dd9e60cee27357eff30226116c49b |          7|\n|         6201|           45|WikiPathways_2019_Human                            |https://www.wikipathways.org/                                                   |      472|b0c9e9ebb9014f14561e896008087725a2db24b7 |          7|\n|         4558|           54|WikiPathways_2019_Mouse                            |https://www.wikipathways.org/                                                   |      176|e7750958da20f585c8b6d5bc4451a5a4305514ba |          7|\n|         3264|           22|TRRUST_Transcription_Factors_2019                  |https://www.grnpedia.org/trrust/                                                |      571|5f8cf93e193d2bcefa5a37ccdf0eefac576861b0 |          1|\n|         7802|           92|KEGG_2019_Human                                    |https://www.kegg.jp/                                                            |      308|3477bc578c4ea5d851dcb934fe2a41e9fd789bb4 |          7|\n|         8551|           98|KEGG_2019_Mouse                                    |https://www.kegg.jp/                                                            |      303|187eb44b2d6fa154ebf628eba1f18537f64e797c |          7|\n|        12444|           23|InterPro_Domains_2019                              |https://www.ebi.ac.uk/interpro/                                                 |     1071|18dd5ec520fdf589a93d6a7911289c205e1ddf22 |          6|\n|         9000|           20|Pfam_Domains_2019                                  |https://pfam.xfam.org/                                                          |      608|a6325ed264f9ac9e6518796076c46a1d885cca7a |          6|\n|         7744|          363|DepMap_WG_CRISPR_Screens_Broad_CellLines_2019      |https://depmap.org/                                                             |      558|0b08b32b20854ac8a738458728a9ea50c2e04800 |          7|\n|         6204|          387|DepMap_WG_CRISPR_Screens_Sanger_CellLines_2019     |https://depmap.org/                                                             |      325|b7c4ead26d0eb64f1697c030d31682b581c8bb56 |          4|\n|        13420|           32|MGI_Mammalian_Phenotype_Level_4_2019               |http://www.informatics.jax.org/                                                 |     5261|f1bed632e89ebc054da44236c4815cdce03ef5ee |          7|\n|        14148|          122|UK_Biobank_GWAS_v1                                 |https://www.ukbiobank.ac.uk/tag/gwas/                                           |      857|958fb52e6215626673a5acf6e9289a1b84d11b4a |          4|\n|         9813|           49|BioPlanet_2019                                     |https://tripod.nih.gov/bioplanet/                                               |     1510|e110851dfc763d30946f2abedcc2cd571ac357a0 |          2|\n|         1397|           13|ClinVar_2019                                       |https://www.ncbi.nlm.nih.gov/clinvar/                                           |      182|0a95303f8059bec08836ecfe02ce3da951150547 |          4|\n|         9116|           22|PheWeb_2019                                        |http://pheweb.sph.umich.edu/                                                    |     1161|6a7c7321b6b72c5285b722f7902d26a2611117cb |          4|\n|        17464|           63|DisGeNET                                           |https://www.disgenet.org                                                        |     9828|3c261626478ce9e6bf2c7f0a8014c5e901d43dc0 |          4|\n|          394|           73|HMS_LINCS_KinomeScan                               |http://lincs.hms.harvard.edu/kinomescan/                                        |      148|47ba06cdc92469ac79400fc57acd84ba343ba616 |          2|\n|        11851|          586|CCLE_Proteomics_2020                               |https://portals.broadinstitute.org/ccle                                         |      378|7094b097ae2301a1d6a5bd856a193b084cca993d |          5|\n|         8189|          421|ProteomicsDB_2020                                  |https://www.proteomicsdb.org/                                                   |      913|8c87c8346167bac2ba68195a32458aba9b1acfd1 |          5|\n|        18704|          100|lncHUB_lncRNA_Co-Expression                        |https://amp.pharm.mssm.edu/lnchub/                                              |     3729|45b597d7efa5693b7e4172b09c0ed2dda3305582 |          1|\n|         5605|           39|Virus-Host_PPI_P-HIPSTer_2020                      |http://phipster.org/                                                            |     6715|a592eed13e8e9496aedbab63003b965574e46a65 |          2|\n|         5718|           31|Elsevier_Pathway_Collection                        |http://www.transgene.ru/disease-pathways/                                       |     1721|9196c760e3bcae9c9de1e3f87ad81f96bde24325 |          2|\n|        14156|           40|Table_Mining_of_CRISPR_Studies                     |                                                                                |      802|ad580f3864fa8ff69eaca11f6d2e7f9b86378d08 |          6|\n|        16979|          295|COVID-19_Related_Gene_Sets                         |https://amp.pharm.mssm.edu/covid19                                              |      205|72b0346849570f66a77a6856722601e711596cb4 |          7|\n|         4383|          146|MSigDB_Hallmark_2020                               |https://www.gsea-msigdb.org/gsea/msigdb/collections.jsp                         |       50|6952efda94663d4bd8db09bf6eeb4e67d21ef58c |          2|\n|        54974|          483|Enrichr_Users_Contributed_Lists_2020               |https://maayanlab.cloud/Enrichr                                                 |     1482|8dc362703b38b30ac3b68b6401a9b20a58e7d3ef |          6|\n|        12118|          448|TG_GATES_2020                                      |https://toxico.nibiohn.go.jp/english/                                           |     1190|9e32560437b11b4628b00ccf3d584360f7f7daee |          4|\n|        12361|          124|Allen_Brain_Atlas_10x_scRNA_2021                   |https://portal.brain-map.org/                                                   |      766|46f8235cb585829331799a71aec3f7c082170219 |          5|\n|         9763|          139|Descartes_Cell_Types_and_Tissue_2021               |https://descartes.brotmanbaty.org/bbi/human-gene-expression-during-development/ |      172|                                         |          5|\n|         8078|          102|KEGG_2021_Human                                    |https://www.kegg.jp/                                                            |      320|                                         |          2|\n|         7173|           43|WikiPathway_2021_Human                             |https://www.wikipathways.org/                                                   |      622|                                         |          7|\n|         5833|          100|HuBMAP_ASCT_plus_B_augmented_w_RNAseq_Coexpression |https://hubmapconsortium.github.io/ccf-asct-reporter/                           |      344|                                         |          5|\n|        14937|           33|GO_Biological_Process_2021                         |http://www.geneontology.org/                                                    |     6036|                                         |          7|\n|        11497|           80|GO_Cellular_Component_2021                         |http://www.geneontology.org/                                                    |      511|                                         |          7|\n|        11936|           34|GO_Molecular_Function_2021                         |http://www.geneontology.org/                                                    |     1274|                                         |          7|\n|         9767|           33|MGI_Mammalian_Phenotype_Level_4_2021               |http://www.informatics.jax.org/                                                 |     4601|                                         |          3|\n|        14167|           80|CellMarker_Augmented_2021                          |http://biocc.hrbmu.edu.cn/CellMarker/                                           |     1097|                                         |          5|\n|        17851|          102|Orphanet_Augmented_2021                            |http://www.orphadata.org/                                                       |     3774|                                         |          4|\n|        16853|          360|COVID-19_Related_Gene_Sets_2021                    |https://maayanlab.cloud/covid19/                                                |      478|                                         |          4|\n|         6654|          136|PanglaoDB_Augmented_2021                           |https://panglaodb.se/                                                           |      178|                                         |          5|\n|         1683|           10|Azimuth_Cell_Types_2021                            |https://azimuth.hubmapconsortium.org/                                           |      341|                                         |          5|\n|        20414|          112|PhenGenI_Association_2021                          |https://www.ncbi.nlm.nih.gov/gap/phegeni                                        |      950|                                         |          4|\n|        26076|          250|RNAseq_Automatic_GEO_Signatures_Human_Down         |https://maayanlab.cloud/archs4/                                                 |     4269|                                         |          8|\n|        26338|          250|RNAseq_Automatic_GEO_Signatures_Human_Up           |https://maayanlab.cloud/archs4/                                                 |     4269|                                         |          8|\n|        25381|          250|RNAseq_Automatic_GEO_Signatures_Mouse_Down         |https://maayanlab.cloud/archs4/                                                 |     4216|                                         |          8|\n|        25409|          250|RNAseq_Automatic_GEO_Signatures_Mouse_Up           |https://maayanlab.cloud/archs4/                                                 |     4216|                                         |          8|\n|        11980|          250|GTEx_Aging_Signatures_2021                         |https://gtexportal.org/                                                         |      270|                                         |          4|\n|        31158|          805|HDSigDB_Human_2021                                 |https://www.hdinhd.org/                                                         |     2564|                                         |          4|\n|        30006|          815|HDSigDB_Mouse_2021                                 |https://www.hdinhd.org/                                                         |     2579|                                         |          4|\n|        13370|          103|HuBMAP_ASCTplusB_augmented_2022                    |https://hubmapconsortium.github.io/ccf-asct-reporter/                           |      777|                                         |          5|\n|        13697|          343|FANTOM6_lncRNA_KD_DEGs                             |https://fantom.gsc.riken.jp/6/                                                  |      350|                                         |          1|\n|         2183|           18|MAGMA_Drugs_and_Diseases                           |https://github.com/nybell/drugsets/tree/main/DATA/GENESETS                      |     1395|                                         |          4|\n|        12765|           13|PFOCR_Pathways                                     |https://pfocr.wikipathways.org/                                                 |    17326|                                         |          7|\n|         1509|          100|Tabula_Sapiens                                     |https://tabula-sapiens-portal.ds.czbiohub.org/                                  |      469|                                         |          5|\n|        18365|         1214|ChEA_2022                                          |https://maayanlab.cloud/chea3/                                                  |      757|                                         |          1|\n|        13525|          175|Diabetes_Perturbations_GEO_2022                    |https://appyters.maayanlab.cloud/#/Gene_Expression_T2D_Signatures               |      601|                                         |          4|\n|         9525|          245|LINCS_L1000_Chem_Pert_Consensus_Sigs               |https://maayanlab.cloud/sigcom-lincs/#/Download                                 |    10850|                                         |          4|\n|         9440|          245|LINCS_L1000_CRISPR_KO_Consensus_Sigs               |https://maayanlab.cloud/sigcom-lincs/#/Download                                 |    10424|                                         |          4|\n|         3857|           80|Tabula_Muris                                       |https://tabula-muris.ds.czbiohub.org/                                           |      106|                                         |          5|\n|        10489|           61|Reactome_2022                                      |https://reactome.org/download-data                                              |     1818|                                         |          2|\n|         1198|           23|SynGO_2022                                         |https://www.syngoportal.org/                                                    |      118|                                         |          3|\n|         1882|           47|GlyGen_Glycosylated_Proteins_2022                  |https://www.glygen.org/                                                         |      338|                                         |          2|\n|         1552|           16|IDG_Drug_Targets_2022                              |https://drugcentral.org/                                                        |      888|                                         |          4|\n|         6713|           68|KOMP2_Mouse_Phenotypes_2022                        |https://www.mousephenotype.org/                                                 |      529|                                         |          3|\n|          936|           15|Metabolomics_Workbench_Metabolites_2022            |https://www.metabolomicsworkbench.org/                                          |      233|                                         |          2|\n|         8220|          146|Proteomics_Drug_Atlas_2023                         |https://www.nature.com/articles/s41587-022-01539-0                              |     1748|                                         |          4|\n|         9021|          793|The_Kinase_Library_2023                            |https://kinase-library.phosphosite.org/site                                     |      303|                                         |          2|\n|         8076|           96|GTEx_Tissues_V8_2023                               |https://gtexportal.org/home/                                                    |      511|                                         |          5|\n|        14698|           33|GO_Biological_Process_2023                         |http://www.geneontology.org/                                                    |     5407|                                         |          3|\n|        10972|           85|GO_Cellular_Component_2023                         |http://www.geneontology.org/                                                    |      474|                                         |          3|\n|        12126|           38|GO_Molecular_Function_2023                         |http://www.geneontology.org/                                                    |     1147|                                         |          3|\n|        13662|           12|PFOCR_Pathways_2023                                |https://pfocr.wikipathways.org/                                                 |    21845|                                         |          2|\n|        18290|           34|GWAS_Catalog_2023                                  |https://www.ebi.ac.uk/gwas                                                      |     5271|                                         |          4|\n|        12081|           50|GeDiPNet_2023                                      |http://gedipnet.bicnirrh.res.in/                                                |     2388|                                         |          4|\n|        12853|          485|MAGNET_2023                                        |https://magnet-winterlab.herokuapp.com/                                         |       72|                                         |          5|\n|         3712|            9|Azimuth_2023                                       |https://azimuth.hubmapconsortium.org/                                           |     1425|                                         |          5|\n|        19178|          218|Rummagene_kinases                                  |https://rummagene.com/                                                          |     3810|                                         |          2|\n|        19434|          369|Rummagene_signatures                               |https://rummagene.com/                                                          |    11130|                                         |          8|\n|        19379|          250|Rummagene_transcription_factors                    |https://rummagene.com/                                                          |     7244|                                         |          1|\n|        10428|          115|MoTrPAC_2023                                       |https://motrpac-data.org/                                                       |      225|                                         |          5|\n|         8044|           42|WikiPathway_2023_Human                             |https://www.wikipathways.org/                                                   |      801|                                         |          2|\n|         9711|          414|DepMap_CRISPR_GeneDependency_CellLines_2023        |https://depmap.org/                                                             |     1093|                                         |          4|\n\n</div>\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nUploading data to Enrichr... Done.\n  Querying GO_Biological_Process_2017b... Done.\nParsing results... Done.\n```\n:::\n:::\n\n{{< meta dge_gsa_hyper_2 >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(1,1),mar = c(3, 25, 2, 1))\nbarplot( height    = -log10(enrich_results$P.value)[10:1],\n        names.arg = enrich_results$Term[10:1],\n        horiz     = TRUE,\n        las       = 1,\n        border    = FALSE,\n        cex.names = .6 )\nabline(v = c(-log10(0.05)), lty = 2)\nabline(v = 0, lty = 1)\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n:::\n\n\n## {{< meta dge_gsea >}}\n\n\n{{< meta dge_gsea_1 >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncell_selection = SetIdent(cell_selection, value = \"type\")\n\nDGE_cell_selection2 <- FindMarkers(\n    cell_selection,\n    ident.1 = \"Covid\",\n    log2FC.threshold = -Inf,\n    test.use = \"wilcox\",\n    min.pct = 0.1,\n    min.diff.pct = 0,\n    only.pos = FALSE,\n    max.cells.per.ident = 50,\n    assay = \"RNA\"\n)\n\n# Create a gene rank based on the gene expression fold change\ngene_rank <- setNames( DGE_cell_selection2$avg_log2FC, casefold(rownames(DGE_cell_selection2),upper=T) )\n```\n:::\n\n{{< meta dge_gsea_2 >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(msigdbr)\n\n#Download gene sets\nmsigdbgmt <- msigdbr::msigdbr(\"Homo sapiens\")\nmsigdbgmt <- as.data.frame(msigdbgmt)\n\n#List available gene sets\nunique(msigdbgmt$gs_subcat)\n\n#Subset which gene set you want to use.\nmsigdbgmt_subset <- msigdbgmt[msigdbgmt$gs_subcat == \"CP:WIKIPATHWAYS\",]\ngmt <- lapply( unique(msigdbgmt_subset$gs_name),function(x){msigdbgmt_subset [msigdbgmt_subset$gs_name == x ,\"gene_symbol\"]} )\nnames(gmt) <- unique(paste0(msigdbgmt_subset$gs_name,\"_\",msigdbgmt_subset$gs_exact_source))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"MIR:MIR_Legacy\"  \"TFT:TFT_Legacy\"  \"CGP\"             \"TFT:GTRD\"       \n [5] \"\"                \"VAX\"             \"CP:BIOCARTA\"     \"CGN\"            \n [9] \"GO:BP\"           \"GO:CC\"           \"IMMUNESIGDB\"     \"GO:MF\"          \n[13] \"HPO\"             \"CP:KEGG\"         \"MIR:MIRDB\"       \"CM\"             \n[17] \"CP\"              \"CP:PID\"          \"CP:REACTOME\"     \"CP:WIKIPATHWAYS\"\n```\n:::\n:::\n\n{{< meta dge_gsea_3 >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fgsea)\n\n# Perform enrichemnt analysis\nfgseaRes <- fgsea( pathways=gmt, stats=gene_rank, minSize=15, maxSize=500)\nfgseaRes <- fgseaRes[ order(fgseaRes$pval, decreasing = T) ,]\n\n# Filter the results table to show only the top 10 UP or DOWN regulated processes (optional)\ntop10_UP <- fgseaRes$pathway [1:10]\n\n# Nice summary table (shown as a plot)\nplotGseaTable(gmt[top10_UP], gene_rank, fgseaRes, gseaParam = 0.5)\n```\n\n::: {.cell-output-display}\n![](seurat_05_dge_files/figure-html/unnamed-chunk-36-1.png){width=1152}\n:::\n:::\n\n\n:::{.callout-note title=\"Discuss\"}\n\n{{< meta dge_gsea_4 >}}\n\n\n:::\n\n\n{{< meta dge_save >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# saveRDS(alldata, \"data/3pbmc_qc_dr_int_cl_dge.rds\")\n# save the list of DGE results to a file.\nwrite.csv(markers_genes, file = \"data/3pbmc_qc_dr_int_cl_dge.csv\")\n```\n:::\n\n\n## {{< meta session >}}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nR version 4.2.3 (2023-03-15)\nPlatform: x86_64-pc-linux-gnu (64-bit)\nRunning under: Ubuntu 22.04.2 LTS\n\nMatrix products: default\nBLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3\nLAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so\n\nlocale:\n [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              \n [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    \n [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   \n [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 \n [9] LC_ADDRESS=C               LC_TELEPHONE=C            \n[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       \n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods  \n[8] base     \n\nother attached packages:\n [1] fgsea_1.24.0                msigdbr_7.5.1              \n [3] lme4_1.1-33                 MAST_1.24.1                \n [5] SingleCellExperiment_1.20.1 SummarizedExperiment_1.28.0\n [7] Biobase_2.58.0              GenomicRanges_1.50.2       \n [9] GenomeInfoDb_1.34.9         IRanges_2.32.0             \n[11] S4Vectors_0.36.2            BiocGenerics_0.44.0        \n[13] MatrixGenerics_1.10.0       matrixStats_1.0.0          \n[15] edgeR_3.40.2                limma_3.54.2               \n[17] Matrix_1.6-0                rafalib_1.0.0              \n[19] enrichR_3.2                 pheatmap_1.0.12            \n[21] ggplot2_3.4.2               cowplot_1.1.1              \n[23] dplyr_1.1.1                 SeuratObject_4.1.3         \n[25] Seurat_4.3.0.1             \n\nloaded via a namespace (and not attached):\n  [1] fastmatch_1.1-3        plyr_1.8.8             igraph_1.5.0          \n  [4] lazyeval_0.2.2         sp_2.0-0               splines_4.2.3         \n  [7] BiocParallel_1.32.6    listenv_0.9.0          scattermore_1.2       \n [10] digest_0.6.33          htmltools_0.5.5        fansi_1.0.4           \n [13] magrittr_2.0.3         tensor_1.5             cluster_2.1.4         \n [16] ROCR_1.0-11            globals_0.16.2         spatstat.sparse_3.0-2 \n [19] prettyunits_1.1.1      colorspace_2.1-0       ggrepel_0.9.3         \n [22] WriteXLS_6.4.0         xfun_0.39              crayon_1.5.2          \n [25] RCurl_1.98-1.12        jsonlite_1.8.7         progressr_0.13.0      \n [28] spatstat.data_3.0-1    survival_3.5-3         zoo_1.8-12            \n [31] glue_1.6.2             polyclip_1.10-4        gtable_0.3.3          \n [34] zlibbioc_1.44.0        XVector_0.38.0         leiden_0.4.3          \n [37] DelayedArray_0.24.0    future.apply_1.11.0    abind_1.4-5           \n [40] scales_1.2.1           spatstat.random_3.1-5  miniUI_0.1.1.1        \n [43] Rcpp_1.0.10            progress_1.2.2         viridisLite_0.4.2     \n [46] xtable_1.8-4           reticulate_1.30        htmlwidgets_1.6.2     \n [49] httr_1.4.6             RColorBrewer_1.1-3     ellipsis_0.3.2        \n [52] ica_1.0-3              pkgconfig_2.0.3        farver_2.1.1          \n [55] uwot_0.1.16            deldir_1.0-9           locfit_1.5-9.8        \n [58] utf8_1.2.3             tidyselect_1.2.0       labeling_0.4.2        \n [61] rlang_1.1.1            reshape2_1.4.4         later_1.3.1           \n [64] munsell_0.5.0          tools_4.2.3            cli_3.6.1             \n [67] generics_0.1.3         ggridges_0.5.4         evaluate_0.21         \n [70] stringr_1.5.0          fastmap_1.1.1          yaml_2.3.7            \n [73] goftest_1.2-3          babelgene_22.9         knitr_1.43            \n [76] fitdistrplus_1.1-11    purrr_1.0.1            RANN_2.6.1            \n [79] pbapply_1.7-2          future_1.33.0          nlme_3.1-162          \n [82] mime_0.12              ggrastr_1.0.2          compiler_4.2.3        \n [85] rstudioapi_0.14        beeswarm_0.4.0         plotly_4.10.2         \n [88] curl_5.0.1             png_0.1-8              spatstat.utils_3.0-3  \n [91] tibble_3.2.1           stringi_1.7.12         lattice_0.20-45       \n [94] nloptr_2.0.3           vctrs_0.6.3            pillar_1.9.0          \n [97] lifecycle_1.0.3        spatstat.geom_3.2-1    lmtest_0.9-40         \n[100] RcppAnnoy_0.0.21       data.table_1.14.8      bitops_1.0-7          \n[103] irlba_2.3.5.1          httpuv_1.6.11          patchwork_1.1.2       \n[106] R6_2.5.1               promises_1.2.0.1       KernSmooth_2.23-20    \n[109] gridExtra_2.3          vipor_0.4.5            parallelly_1.36.0     \n[112] codetools_0.2-19       boot_1.3-28.1          MASS_7.3-58.2         \n[115] rjson_0.2.21           withr_2.5.0            sctransform_0.3.5     \n[118] GenomeInfoDbData_1.2.9 hms_1.1.3              parallel_4.2.3        \n[121] grid_4.2.3             minqa_1.2.5            tidyr_1.3.0           \n[124] rmarkdown_2.21         Rtsne_0.16             spatstat.explore_3.2-1\n[127] shiny_1.7.4            ggbeeswarm_0.7.2      \n```\n:::\n:::\n",
    "supporting": [
      "seurat_05_dge_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}